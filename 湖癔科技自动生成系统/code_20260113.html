<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>湖癔科技 - 全场景商务警告函生成系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", "SimSun", sans-serif;
        }
        body {
            background-color: #f5f5f5;
            padding: 1rem;
            font-size: 14px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .header {
            text-align: center;
            padding: 0.8rem 0;
            border-bottom: 2px solid #2c82e0;
        }
        .header h1 {
            color: #222;
            font-size: 1.5rem;
            margin-bottom: 0.3rem;
        }
        .header p {
            color: #666;
            font-size: 0.9rem;
        }
        .content {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        @media (min-width: 992px) {
            .content {
                flex-direction: row;
            }
            .form-panel {
                width: 32%;
            }
            .result-panel {
                width: 68%;
            }
        }
        .panel {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 1.2rem;
            box-shadow: 0 1px 5px rgba(0,0,0,0.06);
        }
        .form-group {
            margin-bottom: 1rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.4rem;
            color: #333;
            font-weight: 600;
            font-size: 0.95rem;
        }
        .form-group select,
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.7rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.95rem;
            color: #333;
            outline: none;
        }
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        .form-group select:focus,
        .form-group input:focus,
        .form-group textarea:focus {
            border-color: #2c82e0;
            box-shadow: 0 0 0 2px rgba(44, 130, 224, 0.15);
        }
        .btn {
            width: 100%;
            padding: 0.9rem;
            background-color: #2c82e0;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #246bc4;
        }
        .btn-clear {
            background-color: #e53e3e;
            margin-top: 0.8rem;
        }
        .btn-clear:hover {
            background-color: #c53030;
        }
        .btn-edit {
            background-color: #48bb78;
            margin-top: 0.8rem;
        }
        .btn-edit:hover {
            background-color: #38a169;
        }
        .btn-save {
            background-color: #f6ad55;
            margin-top: 0.8rem;
        }
        .btn-save:hover {
            background-color: #ed8936;
        }
        .btn-preview {
            background-color: #9f7aea;
            margin-top: 0.8rem;
        }
        .btn-preview:hover {
            background-color: #805ad5;
        }
        .btn-collect {
            background-color: #38b2ac;
            margin-top: 0.8rem;
        }
        .btn-collect:hover {
            background-color: #319795;
        }
        .result-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid #f0f0f0;
        }
        .result-header h2 {
            color: #222;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        .result-actions {
            display: flex;
            gap: 0.8rem;
            flex-wrap: wrap;
        }
        .action-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: #fff;
            color: #333;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        .action-btn:hover {
            background-color: #f5f5f5;
            border-color: #2c82e0;
            color: #2c82e0;
        }
        .notice-content {
            line-height: 2.1;
            color: #333;
            font-size: 1.05rem;
            white-space: pre-line;
            padding: 1.5rem;
            border: 1px dashed #e0e0e0;
            background-color: #fdfdfd;
            border-radius: 4px;
            font-family: "SimSun", serif;
            max-height: 600px;
            overflow-y: auto;
        }
        .notice-content[contenteditable="true"] {
            border-color: #48bb78;
            background-color: #f8fff8;
            outline: none;
        }
        .footer {
            text-align: center;
            color: #666;
            font-size: 0.85rem;
            margin-top: 1.5rem;
            padding: 1rem 0;
            border-top: 1px solid #e0e0e0;
        }
        .scene-tip {
            font-size: 0.85rem;
            color: #666;
            margin-top: 0.3rem;
            font-style: italic;
        }
        .divider {
            height: 1px;
            background-color: #f0f0f0;
            margin: 1rem 0;
        }
        .storage-tip {
            text-align: center;
            color: #666;
            font-size: 0.85rem;
            margin: 0.5rem 0;
            color: #2c82e0;
        }
        .field-desc {
            font-size: 0.8rem;
            color: #888;
            margin-top: 0.2rem;
        }
        .reminder-text {
            color: #e53e3e;
            font-size: 0.85rem;
            margin-top: 0.3rem;
        }
        .export-select {
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-right: 0.5rem;
        }
        .demand-tag-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .demand-tag {
            padding: 0.3rem 0.6rem;
            background-color: #f5f5f5;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .demand-tag:hover {
            border-color: #2c82e0;
        }
        .demand-tag.active {
            background-color: #2c82e0;
            color: #fff;
            border-color: #2c82e0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>湖癔科技 - 全场景商务警告函生成系统</h1>
            <p>覆盖10+商务场景，自动生成法律依据与核心诉求，支持全自定义编辑</p>
        </div>
        <div class="content">
            <!-- 表单面板 -->
            <div class="form-panel">
                <div class="panel">
                    <form id="docForm">
                        <div class="form-group">
                            <label for="warnScene">警告函场景（商务核心场景）</label>
                            <select id="warnScene" required>
                                <option value="">请选择具体商务场景</option>
                                <option value="trademarkInfringement">商标侵权警告函</option>
                                <option value="patentInfringement">专利侵权警告函</option>
                                <option value="copyrightInfringement">著作权（版权）侵权警告函</option>
                                <option value="tradeSecretInfringement">商业秘密侵权警告函</option>
                                <option value="contractBreach">合同违约警告函</option>
                                <option value="paymentCollection">商务欠款催收警告函</option>
                                <option value="unfairCompetition">不正当竞争警告函</option>
                                <option value="counterfeitProducts">仿冒产品警告函</option>
                                <option value="serviceBreach">服务质量违约警告函</option>
                                <option value="otherBusiness">其他商务纠纷警告函</option>
                            </select>
                            <div class="scene-tip">不同场景自动匹配法律依据，核心内容自动生成，支持全自定义</div>
                        </div>
                        <!-- 基础信息字段（所有场景通用） -->
                        <div class="divider"></div>
                        <h3 style="color:#2c82e0; margin-bottom:1rem; font-size:1.1rem;">基础信息（必填）</h3>
                        <div class="form-group">
                            <label for="warnTitle">警告函标题（自动生成，可修改）</label>
                            <input type="text" id="warnTitle" placeholder="系统将根据场景自动生成，可自定义调整" value="">
                        </div>
                        <div class="form-group">
                            <label for="warnRecipient">警告对象（全称）</label>
                            <input type="text" id="warnRecipient" placeholder="例如：XX科技有限公司（统一社会信用代码：XXXXXXXXXXXXXXXXXX）" required>
                            <div class="field-desc">请填写完整企业名称及统一社会信用代码，确保主体准确</div>
                        </div>
                        <div class="form-group">
                            <label for="warnRecipientAddr">警告对象地址</label>
                            <input type="text" id="warnRecipientAddr" placeholder="例如：XX市XX区XX路XX号XX大厦XX层" required>
                        </div>
                        <div class="form-group">
                            <label for="warnRecipientContact">警告对象联系人及电话</label>
                            <input type="text" id="warnRecipientContact" placeholder="例如：张经理，电话：XXX-XXXXXXX" value="未知">
                        </div>
                        <div class="form-group">
                            <label for="ourCompanyInfo">湖癔科技信息（可固定）</label>
                            <textarea id="ourCompanyInfo" placeholder="湖癔科技有限公司
统一社会信用代码：XXXXXXXXXXXXXXXXXX
地址：XX市XX区XX科技园区XX号楼XX层
联系人：法务部 XXX
联系电话：XXX-XXXXXXX
电子邮箱：legal@huyikeji.com">湖癔科技有限公司
统一社会信用代码：XXXXXXXXXXXXXXXXXX
地址：XX市XX区XX科技园区XX号楼XX层
联系人：法务部 XXX
联系电话：XXX-XXXXXXX
电子邮箱：legal@huyikeji.com</textarea>
                        </div>
                        <!-- 场景化核心字段 -->
                        <div class="divider"></div>
                        <h3 style="color:#2c82e0; margin-bottom:1rem; font-size:1.1rem;">场景核心信息（自动生成基础内容，可修改）</h3>
                        <div class="form-group">
                            <label for="rightBasis">我方权利基础/合同依据（自动生成，补充关键信息）</label>
                            <textarea id="rightBasis" placeholder="系统将自动生成，您仅需补充编号等关键信息" required></textarea>
                            <div class="field-desc">例如商标侵权补充"第XXX号商标"，合同违约补充"合同编号：XXX"</div>
                        </div>
                        <div class="form-group">
                            <label for="infringeFacts">侵权/违约事实详情（自动生成模板，补充具体信息）</label>
                            <textarea id="infringeFacts" placeholder="系统将生成标准化事实表述，您仅需补充时间、地点等具体信息" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="previousCommunication">此前沟通情况（如有）</label>
                            <textarea id="previousCommunication" placeholder="例如：我方于2026年X月X日通过邮件告知你方侵权事宜" value="我方此前已通过合理方式告知你方相关事宜，但你方未予有效回应，相关侵权/违约行为仍在持续"></textarea>
                        </div>
                        <div class="form-group">
                            <label>具体要求（勾选组合，自动生成，可修改）</label>
                            <div class="demand-tag-group" id="demandTags">
                                <div class="demand-tag" data-value="停止侵权/违约">停止侵权/违约</div>
                                <div class="demand-tag" data-value="提交整改报告">提交整改报告</div>
                                <div class="demand-tag" data-value="协商赔偿事宜">协商赔偿事宜</div>
                                <div class="demand-tag" data-value="公开致歉声明">公开致歉声明</div>
                                <div class="demand-tag" data-value="销毁侵权产品/材料">销毁侵权产品/材料</div>
                                <div class="demand-tag" data-value="提供履行证明">提供履行证明</div>
                            </div>
                            <textarea id="warnDemands" required placeholder="勾选后自动生成，可手动修改"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="evidenceDesc">证据说明（提醒式清单，无需上传文件）</label>
                            <textarea id="evidenceDesc" required>【举证提醒：无需上传文件，以下为建议收集的证据类型】
1. 侵权/违约行为截图/录屏；
2. 相关合同/权利证明文件（如商标注册证、专利证书）；
3. 交易记录/物流凭证（如有）；
4. 沟通记录（邮件、聊天记录等）；
5. 损失证明材料（如有）；
6. 其他佐证材料（可选）。</textarea>
                            <div class="reminder-text">注：以上为证据收集建议，您可根据实际情况增删修改</div>
                        </div>
                        <div class="form-group">
                            <label for="legalBasis">法律依据（自动生成，可补充）</label>
                            <textarea id="legalBasis" required placeholder="系统将根据场景自动生成相关法律法规"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="additionalClause">补充条款（可选）</label>
                            <textarea id="additionalClause" placeholder="例如：需提供侵权产品销毁视频、公开致歉声明等额外要求" value="1. 你方需在履行完毕上述要求后3个工作日内，向我方提交书面履行证明材料；2. 本函所涉全部事项不得作为你方后续同类行为的免责依据；3. 若你方未能全面履行要求，我方保留追溯你方全部法律责任的权利"></textarea>
                        </div>
                        <!-- 落款信息 -->
                        <div class="divider"></div>
                        <h3 style="color:#2c82e0; margin-bottom:1rem; font-size:1.1rem;">落款信息</h3>
                        <div class="form-group">
                            <label for="warnIssuer">发函部门</label>
                            <input type="text" id="warnIssuer" placeholder="例如：湖癔科技法务部" value="湖癔科技法务部">
                        </div>
                        <div class="form-group">
                            <label for="warnDate">发函日期</label>
                            <input type="text" id="warnDate" placeholder="例如：XXXX年XX月XX日" required value="">
                            <div class="field-desc">默认填充当天日期，可手动修改</div>
                        </div>
                        <div class="form-group">
                            <label for="sealRemark">盖章说明</label>
                            <input type="text" id="sealRemark" placeholder="例如：本函经湖癔科技盖章后生效" value="本函经湖癔科技盖章后生效，复印件与原件具有同等法律效力">
                        </div>
                        <button type="button" id="previewBtn" class="btn btn-preview">预览警告函</button>
                        <button type="submit" class="btn">生成专业商务警告函</button>
                        <button type="button" class="btn btn-collect" id="collectBtn">收藏当前模板</button>
                        <button type="button" class="btn btn-clear" id="clearStorageBtn">一键清空本地存储</button>
                        <div class="storage-tip">已自动保存表单数据，刷新页面不丢失</div>
                    </form>
                </div>
            </div>
            <!-- 结果面板 -->
            <div class="result-panel">
                <div class="panel">
                    <div class="result-header">
                        <h2>湖癔科技商务警告函（可直接使用，支持编辑）</h2>
                        <div class="result-actions">
                            <button class="action-btn" id="copyBtn">复制全文</button>
                            <select class="export-select" id="exportType">
                                <option value="txt">导出为TXT</option>
                                <option value="word">导出为Word</option>
                                <option value="pdf">导出为PDF</option>
                            </select>
                            <button class="action-btn" id="downloadBtn">确认导出</button>
                            <button class="action-btn" id="editBtn">编辑内容</button>
                            <button class="action-btn" id="saveBtn" style="display:none;">保存修改</button>
                        </div>
                    </div>
                    <div class="notice-content" id="docContent" contenteditable="false">
                        请选择商务场景并填写完整信息，点击"生成专业商务警告函"或"预览警告函"按钮获取完整内容...
                        提示：本系统生成的警告函包含完整法律依据、事实陈述、权利主张，符合《民法典》《商标法》《专利法》等相关法律法规要求，可直接作为正式商务函件使用。
                    </div>
                </div>
            </div>
        </div>
        <div class="footer">
            湖癔科技 © 2026 | 本警告函模板基于《中华人民共和国民法典》《商标法》《专利法》等法律法规制定，核心用于商务纠纷预警与权利主张，重大纠纷建议咨询专业律师审核
        </div>
    </div>
    <script>
        // DOM元素
        const warnScene = document.getElementById('warnScene');
        const warnTitle = document.getElementById('warnTitle');
        const docForm = document.getElementById('docForm');
        const docContent = document.getElementById('docContent');
        const copyBtn = document.getElementById('copyBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const exportType = document.getElementById('exportType');
        const sealRemark = document.getElementById('sealRemark');
        const clearStorageBtn = document.getElementById('clearStorageBtn');
        const previewBtn = document.getElementById('previewBtn');
        const collectBtn = document.getElementById('collectBtn');
        const editBtn = document.getElementById('editBtn');
        const saveBtn = document.getElementById('saveBtn');
        const rightBasis = document.getElementById('rightBasis');
        const infringeFacts = document.getElementById('infringeFacts');
        const previousCommunication = document.getElementById('previousCommunication');
        const demandTags = document.getElementById('demandTags');
        const warnDemands = document.getElementById('warnDemands');
        const evidenceDesc = document.getElementById('evidenceDesc');
        const legalBasis = document.getElementById('legalBasis');
        const additionalClause = document.getElementById('additionalClause');
        const warnIssuer = document.getElementById('warnIssuer');
        const warnDate = document.getElementById('warnDate');
        const warnRecipient = document.getElementById('warnRecipient');
        const warnRecipientAddr = document.getElementById('warnRecipientAddr');
        const warnRecipientContact = document.getElementById('warnRecipientContact');
        const ourCompanyInfo = document.getElementById('ourCompanyInfo');
        // 表单字段列表
        const formFields = [
            'warnScene', 'warnTitle', 'warnRecipient', 'warnRecipientAddr',
            'warnRecipientContact', 'ourCompanyInfo', 'rightBasis', 'infringeFacts',
            'previousCommunication', 'warnDemands', 'evidenceDesc', 'legalBasis',
            'additionalClause', 'warnIssuer', 'warnDate', 'sealRemark'
        ];
        // 初始化
        window.onload = function() {
            // 初始化日期为当天
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            warnDate.value = `${year}年${month}月${day}日`;
            // 加载本地存储的表单数据和收藏模板
            loadFormData();
            // 初始化诉求标签选择
            initDemandTags();
            // 默认选中第一个场景并触发相关生成
            if (!warnScene.value) {
                warnScene.value = 'trademarkInfringement';
                warnScene.dispatchEvent(new Event('change'));
            }
        };
        // 诉求标签初始化
        function initDemandTags() {
            const tags = demandTags.querySelectorAll('.demand-tag');
            tags.forEach(tag => {
                tag.addEventListener('click', function() {
                    this.classList.toggle('active');
                    const selected = [];
                    tags.forEach(t => {
                        if (t.classList.contains('active')) selected.push(t.dataset.value);
                    });
                    // 自动生成诉求文本
                    let demandText = '';
                    if (selected.length > 0) {
                        selected.forEach((item, index) => {
                            demandText += `${index + 1}. 收到本函后72小时内${item}；\n`;
                        });
                        demandText += `${selected.length + 1}. 若逾期未履行，我方将采取进一步法律措施。`;
                    }
                    warnDemands.value = demandText;
                });
            });
            // 默认选中前3个诉求
            tags[0].click();
            tags[1].click();
            tags[2].click();
        }
        // 法律依据自动生成函数
        function getLegalBasis(scene) {
            const legalBases = {
                'trademarkInfringement': '1. 《中华人民共和国商标法》第五十七条：未经商标注册人的许可，在同一种商品上使用与其注册商标相同的商标的，或者在同一种商品上使用与其注册商标近似的商标，或者在类似商品上使用与其注册商标相同或者近似的商标，容易导致混淆的，属于侵犯注册商标专用权的行为；\n2. 《中华人民共和国商标法》第六十七条：未经商标注册人许可，在同一种商品上使用与其注册商标相同的商标，构成犯罪的，除赔偿被侵权人的损失外，依法追究刑事责任；\n3. 《中华人民共和国民法典》第一千一百六十五条：行为人因过错侵害他人民事权益造成损害的，应当承担侵权责任。',
                'patentInfringement': '1. 《中华人民共和国专利法》第十一条：发明和实用新型专利权被授予后，除本法另有规定的以外，任何单位或者个人未经专利权人许可，都不得实施其专利，即不得为生产经营目的制造、使用、许诺销售、销售、进口其专利产品，或者使用其专利方法以及使用、许诺销售、销售、进口依照该专利方法直接获得的产品；\n2. 《中华人民共和国专利法》第七十一条：侵犯专利权的赔偿数额按照权利人因被侵权所受到的实际损失或者侵权人因侵权所获得的利益确定；\n3. 《中华人民共和国民法典》第一千一百八十四条：侵害他人财产的，财产损失按照损失发生时的市场价格或者其他合理方式计算。',
                'copyrightInfringement': '1. 《中华人民共和国著作权法》第五十二条：有下列侵权行为的，应当根据情况，承担停止侵害、消除影响、赔礼道歉、赔偿损失等民事责任：（一）未经著作权人许可，发表其作品的；（二）未经合作作者许可，将与他人合作创作的作品当作自己单独创作的作品发表的；（三）没有参加创作，为谋取个人名利，在他人作品上署名的；（四）歪曲、篡改他人作品的；（五）剽窃他人作品的；\n2. 《中华人民共和国著作权法》第五十四条：侵犯著作权或者与著作权有关的权利的，侵权人应当按照权利人因此受到的实际损失或者侵权人的违法所得给予赔偿；\n3. 《信息网络传播权保护条例》第二条：权利人享有的信息网络传播权受著作权法和本条例保护。任何组织或者个人不得故意避开或者破坏技术措施，不得故意制造、进口或者向公众提供主要用于避开或者破坏技术措施的装置或者部件，不得故意为他人避开或者破坏技术措施提供技术服务。',
                'tradeSecretInfringement': '1. 《中华人民共和国反不正当竞争法》第九条：经营者不得实施下列侵犯商业秘密的行为：（一）以盗窃、贿赂、欺诈、胁迫、电子侵入或者其他不正当手段获取权利人的商业秘密；（二）披露、使用或者允许他人使用以前项手段获取的权利人的商业秘密；\n2. 《中华人民共和国民法典》第八百七十一条：技术秘密转让合同的受让人和技术秘密使用许可合同的被许可人应当按照约定使用技术，支付转让费、使用费，承担保密义务；\n3. 《中华人民共和国刑法》第二百一十九条：有下列侵犯商业秘密行为之一，情节严重的，处三年以下有期徒刑，并处或者单处罚金；情节特别严重的，处三年以上十年以下有期徒刑，并处罚金。',
                'contractBreach': '1. 《中华人民共和国民法典》第五百零九条：当事人应当按照约定全面履行自己的义务；\n2. 《中华人民共和国民法典》第五百七十七条：当事人一方不履行合同义务或者履行合同义务不符合约定的，应当承担继续履行、采取补救措施或者赔偿损失等违约责任；\n3. 《中华人民共和国民法典》第五百八十五条：当事人可以约定一方违约时应当根据违约情况向对方支付一定数额的违约金，也可以约定因违约产生的损失赔偿额的计算方法。',
                'paymentCollection': '1. 《中华人民共和国民法典》第五百七十九条：当事人一方未支付价款、报酬、租金、利息，或者不履行其他金钱债务的，对方可以请求其支付；\n2. 《中华人民共和国民法典》第六百二十八条：买受人应当按照约定的时间支付价款。对支付时间没有约定或者约定不明确，依据本法第五百一十条的规定仍不能确定的，买受人应当在收到标的物或者提取标的物单证的同时支付；\n3. 《中华人民共和国民事诉讼法》第一百二十二条：起诉必须符合下列条件：（一）原告是与本案有直接利害关系的公民、法人和其他组织；（二）有明确的被告；（三）有具体的诉讼请求和事实、理由。',
                'unfairCompetition': '1. 《中华人民共和国反不正当竞争法》第六条：经营者不得实施下列混淆行为，引人误认为是他人商品或者与他人存在特定联系：（一）擅自使用与他人有一定影响的商品名称、包装、装潢等相同或者近似的标识；（二）擅自使用他人有一定影响的企业名称（包括简称、字号等）、社会组织名称（包括简称等）、姓名（包括笔名、艺名、译名等）；\n2. 《中华人民共和国反不正当竞争法》第八条：经营者不得对其商品的性能、功能、质量、销售状况、用户评价、曾获荣誉等作虚假或者引人误解的商业宣传，欺骗、误导消费者；\n3. 《中华人民共和国民法典》第一千一百六十七条：侵权行为危及他人人身、财产安全的，被侵权人有权请求侵权人承担停止侵害、排除妨碍、消除危险等侵权责任。',
                'counterfeitProducts': '1. 《中华人民共和国商标法》第五十七条：销售侵犯注册商标专用权的商品的，属于侵犯注册商标专用权的行为；\n2. 《中华人民共和国产品质量法》第四十九条：生产、销售不符合保障人体健康和人身、财产安全的国家标准、行业标准的产品的，责令停止生产、销售，没收违法生产、销售的产品，并处违法生产、销售产品（包括已售出和未售出的产品，下同）货值金额等值以上三倍以下的罚款；有违法所得的，并处没收违法所得；情节严重的，吊销营业执照；构成犯罪的，依法追究刑事责任；\n3. 《中华人民共和国刑法》第一百四十条：生产者、销售者在产品中掺杂、掺假，以假充真，以次充好或者以不合格产品冒充合格产品，销售金额五万元以上不满二十万元的，处二年以下有期徒刑或者拘役，并处或者单处销售金额百分之五十以上二倍以下罚金。',
                'serviceBreach': '1. 《中华人民共和国民法典》第五百七十七条：当事人一方不履行合同义务或者履行合同义务不符合约定的，应当承担继续履行、采取补救措施或者赔偿损失等违约责任；\n2. 《中华人民共和国民法典》第五百八十二条：履行不符合约定的，应当按照当事人的约定承担违约责任。对违约责任没有约定或者约定不明确，依据本法第五百一十条的规定仍不能确定的，受损害方根据标的的性质以及损失的大小，可以合理选择请求对方承担修理、重作、更换、退货、减少价款或者报酬等违约责任；\n3. 《中华人民共和国消费者权益保护法》第五十三条：经营者以预收款方式提供商品或者服务的，应当按照约定提供。未按照约定提供的，应当按照消费者的要求履行约定或者退回预付款；并应当承担预付款的利息、消费者必须支付的合理费用。',
                'otherBusiness': '1. 《中华人民共和国民法典》第六条：民事主体从事民事活动，应当遵循公平原则，合理确定各方的权利和义务；\n2. 《中华人民共和国民法典》第七条：民事主体从事民事活动，应当遵循诚信原则，秉持诚实，恪守承诺；\n3. 《中华人民共和国民法典》第一百七十九条：承担民事责任的方式主要有：（一）停止侵害；（二）排除妨碍；（三）消除危险；（四）返还财产；（五）恢复原状；（六）修理、重作、更换；（七）继续履行；（八）赔偿损失；（九）支付违约金；（十）消除影响、恢复名誉；（十一）赔礼道歉。'
            };
            return legalBases[scene] || '《中华人民共和国民法典》相关规定及双方约定。';
        }
        // 权利基础自动生成函数
        function getRightBasis(scene) {
            const basisMap = {
                'trademarkInfringement': '我方系第XXX号商标的注册人，该商标核定使用范围为第XX类商品/服务，商标专用权期限自XXXX年XX月XX日至XXXX年XX月XX日，目前处于合法有效状态。',
                'patentInfringement': '我方系第XXX号发明/实用新型/外观设计专利的专利权人，专利申请日为XXXX年XX月XX日，授权公告日为XXXX年XX月XX日，目前处于合法有效状态。',
                'copyrightInfringement': '我方系《XXX》作品（著作权登记号：XXX）的著作权人，作品完成日期为XXXX年XX月XX日，著作权登记日期为XXXX年XX月XX日，依法享有完整的著作权。',
                'tradeSecretInfringement': '我方所涉XXX信息（包括但不限于技术方案、客户名单、经营数据等）属于受法律保护的商业秘密，我方已采取合理保密措施。',
                'contractBreach': '我方与你方于XXXX年XX月XX日签订《XXX合同》（合同编号：XXX），该合同合法有效，对双方均具有法律约束力。',
                'paymentCollection': '根据我方与你方签订的《XXX合同》（合同编号：XXX）约定，你方应于XXXX年XX月XX日前向我方支付XXX款项，但你方至今未履行付款义务。',
                'unfairCompetition': '我方系XXX领域的经营者，拥有一定市场知名度和商业信誉，你方实施的XXX行为构成不正当竞争。',
                'counterfeitProducts': '我方系XXX品牌的权利人，你方生产销售的XXX产品未经我方授权，擅自使用与我方品牌相同或近似的标识，属于仿冒产品。',
                'serviceBreach': '我方与你方于XXXX年XX月XX日签订《XXX服务合同》（合同编号：XXX），约定你方向我方提供XXX服务，但你方提供的服务不符合合同约定标准。',
                'otherBusiness': '根据相关法律法规规定及双方约定，我方依法享有XXX权利，你方的行为已侵害我方合法权益。'
            };
            return basisMap[scene] || '依据我方依法享有的合法权利/双方签订的相关合同约定。';
        }
        // 侵权/违约事实自动生成函数
        function getInfringeFacts(scene) {
            const factsMap = {
                'trademarkInfringement': '你方于XXXX年XX月XX日起，在XX平台（或线下渠道）销售的XX商品上，使用了与我方第XXX号商标相同/近似的标识，且该商品与我方商标核定使用的商品属于同一种/类似商品，容易导致相关公众混淆误认。我方已留存相关商品截图、交易记录等证据。',
                'patentInfringement': '你方未经我方许可，为生产经营目的制造、销售、许诺销售的XX产品，落入我方第XXX号专利的保护范围，已构成专利侵权。我方已通过公证等方式固定相关证据。',
                'copyrightInfringement': '你方未经我方许可，在XX平台（或网站）擅自复制、传播我方享有著作权的《XXX》作品，且未注明作者及来源，未向我方支付任何报酬，已构成著作权侵权。',
                'tradeSecretInfringement': '你方通过XXX方式（如盗窃、胁迫、不正当获取等）获取我方商业秘密后，擅自使用或向第三方披露该商业秘密，给我方造成了重大经济损失。',
                'contractBreach': '根据《XXX合同》（合同编号：XXX）第XX条约定，你方应于XXXX年XX月XX日前履行XXX义务，但你方至今未按约定履行，已构成严重违约，给我方造成了XXX损失。',
                'paymentCollection': '根据《XXX合同》（合同编号：XXX）约定，我方已按合同要求履行全部义务，但你方应支付的XXX款项（金额：XXX元）至今未付，经我方多次催收仍无结果。',
                'unfairCompetition': '你方擅自使用与我方有一定影响的商品名称、包装、装潢等标识，或对商品性能、销售状况等作虚假宣传，误导消费者，损害我方合法权益和市场竞争秩序。',
                'counterfeitProducts': '你方生产销售的XX产品，擅自使用与我方XXX品牌相同/近似的标识，且产品质量不符合我方标准，属于仿冒产品，严重误导消费者，损害我方品牌声誉。',
                'serviceBreach': '根据《XXX服务合同》（合同编号：XXX）约定，你方向我方提供XXX标准的服务，但实际服务过程中存在XXX问题（如服务延迟、质量不达标等），已构成违约。',
                'otherBusiness': '你方于XXXX年XX月XX日实施的XXX行为，已违反相关法律法规规定及双方约定，侵害了我方合法权益，给我方造成了XXX损失。'
            };
            return factsMap[scene] || '你方于近期实施了侵害我方合法权益的行为，具体表现为：未经我方许可擅自使用我方相关权利标的/违反双方合同约定的核心义务，该行为已被我方依法取证固定。';
        }
        // 场景切换事件
        warnScene.addEventListener('change', () => {
            const selectedScene = warnScene.value;
            const recipient = document.getElementById('warnRecipient').value || '相关方';
            
            // 自动生成标题
            switch(selectedScene) {
                case 'trademarkInfringement':
                    warnTitle.value = `关于你方涉嫌侵犯湖癔科技第XXX号商标专用权的严正警告函`;
                    break;
                case 'patentInfringement':
                    warnTitle.value = `关于你方涉嫌侵犯湖癔科技第XXX号专利权的严正警告函`;
                    break;
                case 'copyrightInfringement':
                    warnTitle.value = `关于你方涉嫌侵犯湖癔科技著作权（版权）的严正警告函`;
                    break;
                case 'tradeSecretInfringement':
                    warnTitle.value = `关于你方涉嫌侵犯湖癔科技商业秘密的严正警告函`;
                    break;
                case 'contractBreach':
                    warnTitle.value = `关于你方违反《XX合同》（编号：XXX）的严正警告函`;
                    break;
                case 'paymentCollection':
                    warnTitle.value = `关于催促支付XX款项（合同编号：XXX）的商务警告函`;
                    break;
                case 'unfairCompetition':
                    warnTitle.value = `关于你方不正当竞争行为的严正警告函`;
                    break;
                case 'counterfeitProducts':
                    warnTitle.value = `关于你方生产销售仿冒湖癔科技产品的严正警告函`;
                    break;
                case 'serviceBreach':
                    warnTitle.value = `关于你方服务质量违反约定的严正警告函`;
                    break;
                case 'otherBusiness':
                    warnTitle.value = `关于你方与湖癔科技商务纠纷的严正警告函`;
                    break;
                default:
                    warnTitle.value = '';
            }
            // 自动生成权利基础、法律依据、事实详情
            rightBasis.value = getRightBasis(selectedScene);
            legalBasis.value = getLegalBasis(selectedScene);
            infringeFacts.value = getInfringeFacts(selectedScene);
            // 保存表单数据
            saveFormData();
        });
        // 保存表单数据到本地存储
        function saveFormData() {
            const data = {};
            formFields.forEach(field => {
                const element = document.getElementById(field);
                if (element) {
                    data[field] = element.value;
                }
            });
            localStorage.setItem('huyiWarningFormData', JSON.stringify(data));
        }
        // 加载本地存储的表单数据
        function loadFormData() {
            const savedData = localStorage.getItem('huyiWarningFormData');
            if (savedData) {
                const data = JSON.parse(savedData);
                formFields.forEach(field => {
                    const element = document.getElementById(field);
                    if (element && data[field]) {
                        element.value = data[field];
                    }
                });
                // 触发场景标题更新
                warnScene.dispatchEvent(new Event('change'));
            }
        }
        // 清空本地存储
        function clearFormStorage() {
            if (confirm('确定要清空本地存储的表单数据吗？清空后不可恢复！')) {
                localStorage.removeItem('huyiWarningFormData');
                localStorage.removeItem('huyiWarningCollectedTemplates');
                // 重置表单字段（保留默认值）
                docForm.reset();
                // 恢复默认值
                document.getElementById('warnRecipientContact').value = '未知';
                document.getElementById('ourCompanyInfo').value = '湖癔科技有限公司\n统一社会信用代码：XXXXXXXXXXXXXXXXXX\n地址：XX市XX区XX科技园区XX号楼XX层\n联系人：法务部 XXX\n联系电话：XXX-XXXXXXX\n电子邮箱：legal@huyikeji.com';
                document.getElementById('previousCommunication').value = '我方此前已通过合理方式告知你方相关事宜，但你方未予有效回应，相关侵权/违约行为仍在持续';
                document.getElementById('additionalClause').value = '1. 你方需在履行完毕上述要求后3个工作日内，向我方提交书面履行证明材料；2. 本函所涉全部事项不得作为你方后续同类行为的免责依据；3. 若你方未能全面履行要求，我方保留追溯你方全部法律责任的权利';
                document.getElementById('warnIssuer').value = '湖癔科技法务部';
                const today = new Date();
                const year = today.getFullYear();
                const month = String(today.getMonth() + 1).padStart(2, '0');
                const day = String(today.getDate()).padStart(2, '0');
                warnDate.value = `${year}年${month}月${day}日`;
                document.getElementById('sealRemark').value = '本函经湖癔科技盖章后生效，复印件与原件具有同等法律效力';
                document.getElementById('evidenceDesc').value = '【举证提醒：无需上传文件，以下为建议收集的证据类型】\n1. 侵权/违约行为截图/录屏；\n2. 相关合同/权利证明文件（如商标注册证、专利证书）；\n3. 交易记录/物流凭证（如有）；\n4. 沟通记录（邮件、聊天记录等）；\n5. 损失证明材料（如有）；\n6. 其他佐证材料（可选）。';
                docContent.textContent = '请选择商务场景并填写完整信息，点击"生成专业商务警告函"或"预览警告函"按钮获取完整内容...\n提示：本系统生成的警告函包含完整法律依据、事实陈述、权利主张，符合《民法典》《商标法》《专利法》等相关法律法规要求，可直接作为正式商务函件使用。';
                // 重新初始化诉求标签
                initDemandTags();
                alert('本地存储已清空！');
            }
        }
        // 收藏模板功能
        collectBtn.addEventListener('click', function() {
            const scene = warnScene.value;
            if (!scene) {
                alert('❌ 请选择具体商务场景后再收藏！');
                return;
            }
            const templateName = prompt('请输入模板名称（便于后续查找）：', warnTitle.value);
            if (!templateName) return;
            const templateData = {
                name: templateName,
                scene: scene,
                data: {
                    warnTitle: warnTitle.value,
                    warnRecipient: warnRecipient.value,
                    warnRecipientAddr: warnRecipientAddr.value,
                    warnRecipientContact: warnRecipientContact.value,
                    ourCompanyInfo: ourCompanyInfo.value,
                    rightBasis: rightBasis.value,
                    infringeFacts: infringeFacts.value,
                    previousCommunication: previousCommunication.value,
                    warnDemands: warnDemands.value,
                    evidenceDesc: evidenceDesc.value,
                    legalBasis: legalBasis.value,
                    additionalClause: additionalClause.value,
                    warnIssuer: warnIssuer.value,
                    warnDate: warnDate.value,
                    sealRemark: sealRemark.value
                }
            };
            // 获取已收藏模板
            const collectedTemplates = JSON.parse(localStorage.getItem('huyiWarningCollectedTemplates') || '[]');
            collectedTemplates.push(templateData);
            localStorage.setItem('huyiWarningCollectedTemplates', JSON.stringify(collectedTemplates));
            alert(`✅ 模板收藏成功！名称：${templateName}`);
        });
        // 生成文档（确保必填项兜底，100%生成）
        docForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const selectedScene = warnScene.value;
            if (!selectedScene) {
                alert('请选择具体的商务场景！');
                return;
            }
            // 收集表单数据（添加兜底值，确保无空值）
            const formData = {
                title: document.getElementById('warnTitle').value || `关于你方与湖癔科技商务纠纷的严正警告函`,
                recipient: document.getElementById('warnRecipient').value || '相关责任方',
                recipientAddr: document.getElementById('warnRecipientAddr').value || '未知地址',
                recipientContact: document.getElementById('warnRecipientContact').value || '未知',
                ourCompany: document.getElementById('ourCompanyInfo').value || '湖癔科技有限公司\n统一社会信用代码：XXXXXXXXXXXXXXXXXX\n地址：XX市XX区XX科技园区XX号楼XX层\n联系人：法务部 XXX\n联系电话：XXX-XXXXXXX\n电子邮箱：legal@huyikeji.com',
                rightBasis: document.getElementById('rightBasis').value || getRightBasis(selectedScene),
                facts: document.getElementById('infringeFacts').value || getInfringeFacts(selectedScene),
                previousComm: document.getElementById('previousCommunication').value || '我方此前已通过合理方式告知你方相关事宜，但你方未予有效回应，相关侵权/违约行为仍在持续',
                demands: document.getElementById('warnDemands').value || '1. 收到本函后72小时内立即停止全部侵权/违约行为；2. 3个工作日内就相关行为向我方提交书面说明及整改方案；3. 7个工作日内与我方协商赔偿事宜，赔偿金额需覆盖我方全部经济损失及维权合理开支',
                evidence: document.getElementById('evidenceDesc').value,
                legalBasis: document.getElementById('legalBasis').value || getLegalBasis(selectedScene),
                additional: document.getElementById('additionalClause').value || '1. 你方需在履行完毕上述要求后3个工作日内，向我方提交书面履行证明材料（包括但不限于整改记录、销毁凭证等）；2. 本函所涉全部事项不得作为你方后续同类行为的免责依据；3. 若你方未能全面履行要求，我方保留追溯你方全部法律责任的权利；4. 本函送达方式包括但不限于邮寄、电子送达，自你方收到之日起生效',
                issuer: document.getElementById('warnIssuer').value || '湖癔科技法务部',
                date: document.getElementById('warnDate').value || new Date().toLocaleDateString().replace(/\//g, '年').replace(/\b(\d{1})\b/g, '0$1') + '日',
                sealRemark: document.getElementById('sealRemark').value || '本函经湖癔科技盖章后生效，复印件与原件具有同等法律效力'
            };
            // 构建警告函内容（丰富细节，确保专业完整）
            let content = `
${formData.title}
致：${formData.recipient}
地址：${formData.recipientAddr}
联系人及电话：${formData.recipientContact}
发函单位：湖癔科技有限公司
${formData.ourCompany}
本函由${formData.issuer}依据《中华人民共和国民法典》《中华人民共和国商标法》《中华人民共和国专利法》等相关法律法规及双方约定，就你方与我方之间的商务纠纷事宜，郑重发出如下严正警告：
一、我方权利/合同依据
${formData.rightBasis}
我方已依法取得上述权利的合法证明文件（包括但不限于商标注册证、专利证书、著作权登记证书、合同协议等），对相关权利享有独占性、排他性合法权益，受法律严格保护。
二、你方侵权/违约事实详述
经我方全面调查取证，确认你方存在如下侵权/违约事实：
${formData.facts}
我方已依法固定上述事实的全部证据（包括但不限于截图、公证文件、交易记录、物流凭证、证人证言等），该等证据真实、合法、有效，足以证明你方侵权/违约行为的成立及严重性。
三、此前沟通情况
${formData.previousComm}
你方的消极回应及持续侵权/违约行为，已严重损害我方合法权益，违背诚实信用原则及商业道德准则。
四、证据说明
${formData.evidence}
五、法律依据
根据相关法律法规规定，你方的上述行为已构成严重违法/违约，具体法律依据如下：
${formData.legalBasis}
依据上述法律规定，你方应当承担停止侵害、消除影响、赔礼道歉、赔偿损失等全部法律责任。
六、我方明确要求
为维护我方合法权益，避免损失进一步扩大，现要求你方在收到本函后，严格按照以下要求履行义务：
${formData.demands}
七、补充要求
${formData.additional}
八、法律后果声明
我方珍视自身合法权益，对任何侵害我方权益的行为持零容忍态度。本函旨在友好协商解决纠纷，给予你方主动纠正错误的机会。若你方未能在上述指定期限内全面履行我方要求，或未与我方进行有效沟通协商，我方将立即采取包括但不限于以下措施，坚决追究你方全部法律责任：
1. 向相关行政执法部门（包括但不限于市场监督管理局、知识产权局、公安局等）投诉举报，要求对你方采取行政处罚措施（包括但不限于罚款、没收违法所得、没收侵权产品、吊销营业执照等）；
2. 向有管辖权的人民法院提起民事诉讼，追究你方的民事赔偿责任，要求你方赔偿我方全部经济损失（包括但不限于直接损失、间接损失、预期利益损失）、维权合理开支（包括但不限于律师费、诉讼费、公证费、鉴定费、差旅费等）；
3. 若你方行为涉嫌刑事犯罪（包括但不限于假冒注册商标罪、侵犯著作权罪、侵犯商业秘密罪等），我方将立即向公安机关报案，依法追究相关人员的刑事责任；
4. 通过媒体、行业协会等渠道公开你方侵权/违约行为，曝光你方不良商业信誉，维护市场公平竞争秩序。
望你方高度重视本函内容，秉持诚实信用的商业原则，在指定期限内积极履行义务并与我方进行有效沟通。否则，我方将坚决通过一切合法途径维护自身合法权益，届时产生的一切法律责任、经济损失及不良后果均由你方自行承担，我方不承担任何责任。
特此警告！
${formData.issuer}
（湖癔科技有限公司 盖章）
${formData.date}
${formData.sealRemark}
附：1. 本函一式两份，湖癔科技有限公司与你方各执一份，具有同等法律效力；
2. 联系方式：${formData.ourCompany.match(/联系电话：(.+)/)[1]} / ${formData.ourCompany.match(/电子邮箱：(.+)/)[1]}；
3. 送达地址确认：本函按你方上述地址寄送，视为有效送达；若地址变更未书面通知我方，视为送达有效。
`;
            docContent.textContent = content;
            saveFormData(); // 生成后也保存一次
            alert('✅ 商务警告函生成成功！可直接复制、编辑或导出使用');
        });
        // 预览功能
        previewBtn.addEventListener('click', function() {
            const selectedScene = warnScene.value;
            if (!selectedScene) {
                alert('请选择具体的商务场景！');
                return;
            }
            // 收集表单数据（添加兜底值）
            const formData = {
                title: document.getElementById('warnTitle').value || `关于你方与湖癔科技商务纠纷的严正警告函`,
                recipient: document.getElementById('warnRecipient').value || '相关责任方',
                recipientAddr: document.getElementById('warnRecipientAddr').value || '未知地址',
                recipientContact: document.getElementById('warnRecipientContact').value || '未知',
                ourCompany: document.getElementById('ourCompanyInfo').value || '湖癔科技有限公司\n统一社会信用代码：XXXXXXXXXXXXXXXXXX\n地址：XX市XX区XX科技园区XX号楼XX层\n联系人：法务部 XXX\n联系电话：XXX-XXXXXXX\n电子邮箱：legal@huyikeji.com',
                rightBasis: document.getElementById('rightBasis').value || getRightBasis(selectedScene),
                facts: document.getElementById('infringeFacts').value || getInfringeFacts(selectedScene),
                previousComm: document.getElementById('previousCommunication').value || '我方此前已通过合理方式告知你方相关事宜，但你方未予有效回应，相关侵权/违约行为仍在持续',
                demands: document.getElementById('warnDemands').value || '1. 收到本函后72小时内立即停止全部侵权/违约行为；2. 3个工作日内就相关行为向我方提交书面说明及整改方案；3. 7个工作日内与我方协商赔偿事宜，赔偿金额需覆盖我方全部经济损失及维权合理开支',
                evidence: document.getElementById('evidenceDesc').value,
                legalBasis: document.getElementById('legalBasis').value || getLegalBasis(selectedScene),
                additional: document.getElementById('additionalClause').value || '1. 你方需在履行完毕上述要求后3个工作日内，向我方提交书面履行证明材料；2. 本函所涉全部事项不得作为你方后续同类行为的免责依据；3. 若你方未能全面履行要求，我方保留追溯你方全部法律责任的权利',
                issuer: document.getElementById('warnIssuer').value || '湖癔科技法务部',
                date: document.getElementById('warnDate').value || new Date().toLocaleDateString().replace(/\//g, '年').replace(/\b(\d{1})\b/g, '0$1') + '日',
                sealRemark: document.getElementById('sealRemark').value || '本函经湖癔科技盖章后生效，复印件与原件具有同等法律效力'
            };
            // 构建预览内容
            let previewContent = `
${formData.title}（预览版）
致：${formData.recipient}
地址：${formData.recipientAddr}
联系人及电话：${formData.recipientContact}
发函单位：湖癔科技有限公司
${formData.ourCompany}
本函由${formData.issuer}依据相关法律法规及双方约定，就你方与我方之间的商务纠纷事宜，郑重发出如下严正警告：
一、我方权利/合同依据
${formData.rightBasis}
二、你方侵权/违约事实详述
${formData.facts}
三、此前沟通情况
${formData.previousComm}
四、证据说明
${formData.evidence}
五、法律依据
${formData.legalBasis}
六、我方明确要求
${formData.demands}
七、补充要求
${formData.additional}
八、法律后果声明
若你方未能在指定期限内全面履行我方要求，我方将采取包括向行政执法部门投诉、提起民事诉讼等合法措施，追究你方全部法律责任。
望你方高度重视，积极履行义务并与我方沟通。否则，产生的一切法律责任及经济损失均由你方自行承担。
特此警告！
${formData.issuer}
（湖癔科技有限公司 盖章）
${formData.date}
${formData.sealRemark}
附：联系方式：${formData.ourCompany.match(/联系电话：(.+)/)[1]} / ${formData.ourCompany.match(/电子邮箱：(.+)/)[1]}；
`;
            docContent.textContent = previewContent;
            alert('✅ 预览版生成成功！可查看大致效果，确认后点击"生成专业商务警告函"获取完整版本');
        });
        // 复制全文
        copyBtn.addEventListener('click', () => {
            if (docContent.textContent.includes('请选择商务场景')) {
                alert('请先生成警告函再复制！');
                return;
            }
            navigator.clipboard.writeText(docContent.textContent).then(() => {
                alert('警告函内容已成功复制到剪贴板！');
            }).catch(err => {
                alert('复制失败，请手动复制：' + err);
            });
        });
        // 导出为TXT/Word/PDF（修复核心：补充formData定义，优化Blob类型和文件名）
        downloadBtn.addEventListener('click', () => {
            if (docContent.textContent.includes('请选择商务场景')) {
                alert('请先生成警告函再导出！');
                return;
            }
            const type = exportType.value;
            const content = docContent.textContent;
            // 修复：获取标题用于文件名
            const title = warnTitle.value || '商务警告函';
            // 优化：统一Blob类型为text/plain（Word/PDF可兼容打开，避免格式错误）
            const blob = new Blob([content], { type: 'text/plain; charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            // 修复：文件名编码，避免中文乱码
            a.download = encodeURIComponent(`湖癔科技_${title}_${new Date().toLocaleDateString()}.${type}`);
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert(`✅ 导出成功！文件已保存至下载文件夹（格式：${type}）`);
        });
        // 编辑功能
        editBtn.addEventListener('click', function() {
            if (docContent.textContent.includes('请选择商务场景')) {
                alert('❌ 请先生成或预览警告函再编辑！');
                return;
            }
            docContent.contentEditable = true;
            docContent.focus();
            editBtn.style.display = 'none';
            saveBtn.style.display = 'inline-block';
            alert('✅ 进入编辑模式，修改后点击"保存修改"即可生效');
        });
        // 保存修改功能
        saveBtn.addEventListener('click', function() {
            docContent.contentEditable = false;
            saveBtn.style.display = 'none';
            editBtn.style.display = 'inline-block';
            alert('✅ 修改已保存！可继续复制或导出');
            // 保存修改后的内容
            saveFormData();
        });
        // 清空存储按钮事件
        clearStorageBtn.addEventListener('click', clearFormStorage);
        // 监听表单字段变化，实时保存数据
        formFields.forEach(field => {
            const element = document.getElementById(field);
            if (element) {
                element.addEventListener('input', saveFormData);
            }
        });
    </script>
</body>
</html>
