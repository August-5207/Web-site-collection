<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>湖癔科技 - 全场景内部通知生成系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", "SimSun", sans-serif;
        }
        body {
            background-color: #f5f5f5;
            padding: 1rem;
            font-size: 14px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .header {
            text-align: center;
            padding: 0.8rem 0;
            border-bottom: 2px solid #2c82e0;
        }
        .header h1 {
            color: #222;
            font-size: 1.5rem;
            margin-bottom: 0.3rem;
        }
        .header p {
            color: #666;
            font-size: 0.9rem;
        }
        .content {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        @media (min-width: 992px) {
            .content {
                flex-direction: row;
            }
            .form-panel {
                width: 33%;
            }
            .result-panel {
                width: 67%;
            }
        }
        .panel {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 1.2rem;
            box-shadow: 0 1px 5px rgba(0,0,0,0.06);
        }
        .form-group {
            margin-bottom: 1rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.4rem;
            color: #333;
            font-weight: 600;
            font-size: 0.95rem;
        }
        .form-group select,
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.7rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.95rem;
            color: #333;
            outline: none;
        }
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        .form-group select:focus,
        .form-group input:focus,
        .form-group textarea:focus {
            border-color: #2c82e0;
            box-shadow: 0 0 0 2px rgba(44, 130, 224, 0.15);
        }
        .btn {
            width: 100%;
            padding: 0.9rem;
            background-color: #2c82e0;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #246bc4;
        }
        .btn-clear {
            background-color: #e53e3e;
            margin-top: 0.8rem;
        }
        .btn-clear:hover {
            background-color: #c53030;
        }
        .btn-edit {
            background-color: #48bb78;
            margin-top: 0.8rem;
        }
        .btn-edit:hover {
            background-color: #38a169;
        }
        .btn-save {
            background-color: #f6ad55;
            margin-top: 0.8rem;
        }
        .btn-save:hover {
            background-color: #ed8936;
        }
        .btn-preview {
            background-color: #9f7aea;
            margin-top: 0.8rem;
        }
        .btn-preview:hover {
            background-color: #805ad5;
        }
        .btn-collect {
            background-color: #38b2ac;
            margin-top: 0.8rem;
        }
        .btn-collect:hover {
            background-color: #319795;
        }
        .result-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid #f0f0f0;
        }
        .result-header h2 {
            color: #222;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        .result-actions {
            display: flex;
            gap: 0.8rem;
            flex-wrap: wrap;
        }
        .action-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: #fff;
            color: #333;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        .action-btn:hover {
            background-color: #f5f5f5;
            border-color: #2c82e0;
            color: #2c82e0;
        }
        .notice-content {
            line-height: 2.1;
            color: #333;
            font-size: 1.05rem;
            white-space: pre-line;
            padding: 1.5rem;
            border: 1px dashed #e0e0e0;
            background-color: #fdfdfd;
            border-radius: 4px;
            font-family: "SimSun", serif;
            max-height: 600px;
            overflow-y: auto;
        }
        .notice-content[contenteditable="true"] {
            border-color: #48bb78;
            background-color: #f8fff8;
            outline: none;
        }
        .footer {
            text-align: center;
            color: #666;
            font-size: 0.85rem;
            margin-top: 1.5rem;
            padding: 1rem 0;
            border-top: 1px solid #e0e0e0;
        }
        .scene-tip {
            font-size: 0.85rem;
            color: #666;
            margin-top: 0.3rem;
            font-style: italic;
        }
        .divider {
            height: 1px;
            background-color: #f0f0f0;
            margin: 1rem 0;
        }
        .storage-tip {
            text-align: center;
            color: #666;
            font-size: 0.85rem;
            margin: 0.5rem 0;
            color: #2c82e0;
        }
        .field-desc {
            font-size: 0.8rem;
            color: #888;
            margin-top: 0.2rem;
        }
        .reminder-text {
            color: #e53e3e;
            font-size: 0.85rem;
            margin-top: 0.3rem;
        }
        .export-select {
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-right: 0.5rem;
        }
        .tag-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .tag {
            padding: 0.3rem 0.6rem;
            background-color: #f5f5f5;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .tag:hover {
            border-color: #2c82e0;
        }
        .tag.active {
            background-color: #2c82e0;
            color: #fff;
            border-color: #2c82e0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>湖癔科技 - 全场景内部通知生成系统</h1>
            <p>覆盖员工管理、自研系统、网络安全等15+场景，自动生成专业内容，支持全自定义编辑</p>
        </div>
        <div class="content">
            <!-- 表单面板 -->
            <div class="form-panel">
                <div class="panel">
                    <form id="noticeForm">
                        <div class="form-group">
                            <label for="noticeScene">通知场景分类</label>
                            <select id="noticeScene" required>
                                <option value="">请选择通知场景</option>
                                <!-- 员工管理类 -->
                                <option value="employeeFired">员工开除通知</option>
                                <option value="employeePromote">员工晋升通知</option>
                                <option value="employeeTransfer">员工调岗通知</option>
                                <option value="employeeTraining">员工培训通知</option>
                                <option value="employeeDiscipline">员工违纪警告通知</option>
                                <!-- 自研系统类 -->
                                <option value="systemLaunch">自研系统上线通知</option>
                                <option value="systemUpdate">自研系统更新通知</option>
                                <option value="systemMaintenance">自研系统维护通知</option>
                                <option value="systemTest">自研系统测试通知</option>
                                <option value="systemStop">自研系统停用通知</option>
                                <!-- 网络安全类 -->
                                <option value="networkAttack">服务器/网络攻击预警通知</option>
                                <option value="virusAttack">病毒攻击应急通知</option>
                                <option value="dataSecurity">数据安全管控通知</option>
                                <option value="securityTraining">网络安全培训通知</option>
                                <!-- 综合管理类 -->
                                <option value="meetingNotice">会议通知</option>
                                <option value="officeMove">办公地址搬迁通知</option>
                                <option value="holidayArrangement">节假日安排通知</option>
                                <option value="otherNotice">其他内部通知</option>
                            </select>
                            <div class="scene-tip">不同场景自动匹配专业模板，支持全自定义修改</div>
                        </div>
                        <!-- 基础信息字段（所有场景通用） -->
                        <div class="divider"></div>
                        <h3 style="color:#2c82e0; margin-bottom:1rem; font-size:1.1rem;">基础信息（必填）</h3>
                        <div class="form-group">
                            <label for="noticeTitle">通知标题（自动生成，可修改）</label>
                            <input type="text" id="noticeTitle" placeholder="系统将根据场景自动生成" value="">
                        </div>
                        <div class="form-group">
                            <label for="noticeRecipient">通知对象</label>
                            <input type="text" id="noticeRecipient" placeholder="例如：公司各部门、全体员工" required value="全体员工">
                            <div class="field-desc">可填写具体部门、岗位或全员</div>
                        </div>
                        <div class="form-group">
                            <label for="noticeDate">通知发布日期</label>
                            <input type="text" id="noticeDate" placeholder="例如：2026年01月01日" required value="2026年01月01日">
                            <div class="field-desc">默认填充当天日期，可手动修改</div>
                        </div>
                        <div class="form-group">
                            <label for="noticeIssuer">发布部门/负责人</label>
                            <input type="text" id="noticeIssuer" placeholder="例如：人力资源部、技术部" required value="湖癔科技人力资源部">
                        </div>
                        <div class="form-group">
                            <label for="contactPerson">联系人及联系方式</label>
                            <input type="text" id="contactPerson" placeholder="例如：张经理，电话：13800138000" required value="张经理，电话：13800138000">
                        </div>
                        <!-- 员工管理类字段 -->
                        <div id="employeeFields" style="display:none;">
                            <div class="divider"></div>
                            <h3 style="color:#2c82e0; margin-bottom:1rem; font-size:1.1rem;">员工管理核心信息</h3>
                            <div class="form-group">
                                <label for="employeeName">员工姓名/相关人员</label>
                                <input type="text" id="employeeName" required value="张三">
                                <div class="field-desc">开除/晋升/调岗需填写具体姓名，培训/警告可填写群体</div>
                            </div>
                            <div class="form-group">
                                <label for="employeeDept">所属部门/原岗位</label>
                                <input type="text" id="employeeDept" required value="市场部">
                            </div>
                            <div class="form-group">
                                <label for="employeeReason">事由详情（自动生成基础内容，可修改）</label>
                                <textarea id="employeeReason" required>在工作期间多次违反公司考勤制度，累计旷工5天，经多次警告仍未整改，严重影响部门工作进度。</textarea>
                            </div>
                            <div class="form-group">
                                <label for="employeeRule">依据制度/条款（自动生成，可补充编号）</label>
                                <input type="text" id="employeeRule" value="《湖癔科技员工管理手册》第三章第5条">
                                <div class="field-desc">系统已自动匹配核心制度，可补充具体条款编号</div>
                            </div>
                            <div class="form-group">
                                <label for="employeeArrangement">后续安排/要求（自动生成，可修改）</label>
                                <textarea id="employeeArrangement" required>1. 限3个工作日内完成工作交接，交接清单需经部门负责人签字确认；2. 办理完毕离职手续及物品归还；3. 离职后不得泄露公司商业秘密。</textarea>
                            </div>
                        </div>
                        <!-- 自研系统类字段 -->
                        <div id="systemFields" style="display:none;">
                            <div class="divider"></div>
                            <h3 style="color:#2c82e0; margin-bottom:1rem; font-size:1.1rem;">自研系统核心信息</h3>
                            <div class="form-group">
                                <label for="systemName">系统名称</label>
                                <input type="text" id="systemName" required value="湖癔科技OS V2.0">
                            </div>
                            <div class="form-group">
                                <label for="systemVersion">系统版本（如有）</label>
                                <input type="text" id="systemVersion" value="V2.0正式版">
                            </div>
                            <div class="form-group">
                                <label for="systemTime">相关时间</label>
                                <input type="text" id="systemTime" required value="上线时间：2026年01月10日">
                                <div class="field-desc">上线/更新/维护/测试需填写具体时间，系统自动匹配场景表述</div>
                            </div>
                            <div class="form-group">
                                <label for="systemContent">核心内容/变更说明（自动生成，可修改）</label>
                                <textarea id="systemContent" required>1. 新增智能办公模块，支持文档协同编辑；2. 优化系统稳定性，修复已知漏洞；3. 适配更多硬件设备，提升兼容性。</textarea>
                            </div>
                            <div class="form-group">
                                <label for="systemRequirement">使用要求/注意事项（自动生成，可修改）</label>
                                <textarea id="systemRequirement" required>1. 各部门组织员工参加系统操作培训（时间：2026年01月08日）；2. 上线前备份重要数据；3. 使用中遇问题联系技术部李工（电话：13900139000）。</textarea>
                            </div>
                        </div>
                        <!-- 网络安全类字段 -->
                        <div id="securityFields" style="display:none;">
                            <div class="divider"></div>
                            <h3 style="color:#2c82e0; margin-bottom:1rem; font-size:1.1rem;">网络安全核心信息</h3>
                            <div class="form-group">
                                <label for="securityEvent">安全事件详情（自动生成，可修改）</label>
                                <textarea id="securityEvent" required>检测到针对公司核心服务器的DDoS攻击，攻击来源为境外IP，目前已影响部分非核心业务系统访问速度。</textarea>
                            </div>
                            <div class="form-group">
                                <label for="securityTime">事件发生/预警时间</label>
                                <input type="text" id="securityTime" required value="2026年01月05日 08:30；预计风险周期：24小时">
                            </div>
                            <div class="form-group">
                                <label for="securityImpact">影响范围/潜在风险（自动生成，可修改）</label>
                                <textarea id="securityImpact" required>1. 影响服务器：S1、S3非核心服务器；2. 涉及数据：非敏感业务数据；3. 潜在风险：若攻击持续可能导致核心业务受影响。</textarea>
                            </div>
                            <div class="form-group">
                                <label for="securityMeasure">应急措施/防控要求（自动生成，可修改）</label>
                                <textarea id="securityMeasure" required>1. 技术部启动应急防护机制，封禁攻击IP；2. 暂时关闭非核心业务外网访问；3. 全体员工不得点击来历不明链接，修改办公系统登录密码；4. 数据中心完成核心数据紧急备份。</textarea>
                            </div>
                            <div class="form-group">
                                <label for="securityResponsibility">责任分工/上报机制（自动生成，可修改）</label>
                                <textarea id="securityResponsibility" required>1. 技术部：24小时监测攻击情况，及时优化防护策略；2. 各部门：指定安全联络员，检查本部门设备安全；3. 发现异常立即上报安全应急小组（邮箱：security@huyikeji.com）。</textarea>
                            </div>
                        </div>
                        <!-- 综合管理类字段 -->
                        <div id="generalFields" style="display:none;">
                            <div class="divider"></div>
                            <h3 style="color:#2c82e0; margin-bottom:1rem; font-size:1.1rem;">综合管理核心信息</h3>
                            <div class="form-group">
                                <label for="generalTheme">通知核心主题</label>
                                <input type="text" id="generalTheme" required value="2026年春节放假安排">
                            </div>
                            <div class="form-group">
                                <label for="generalDetail">具体详情（自动生成，可修改）</label>
                                <textarea id="generalDetail" required>1. 放假时间：2026年01月29日-02月07日（共10天）；2. 值班安排：各部门轮流值班，名单详见内部邮件；3. 复工时间：2026年02月08日（周四）。</textarea>
                            </div>
                            <div class="form-group">
                                <label for="generalRequirement">相关要求/注意事项（自动生成，可修改）</label>
                                <textarea id="generalRequirement" required>1. 放假前完成工作交接，关闭办公设备电源；2. 值班人员按时到岗，及时处理突发事项；3. 注意出行安全，保持通讯畅通。</textarea>
                            </div>
                        </div>
                        <!-- 补充条款 -->
                        <div class="divider"></div>
                        <h3 style="color:#2c82e0; margin-bottom:1rem; font-size:1.1rem;">补充信息</h3>
                        <div class="form-group">
                            <label for="additionalClause">补充条款（可选，自动生成基础内容）</label>
                            <textarea id="additionalClause">1. 本通知自发布之日起生效，未尽事宜可联系相关负责人咨询；
2. 请相关方严格遵照执行，逾期未落实将按公司制度处理；
3. 本通知最终解释权归湖癔科技相关部门所有。</textarea>
                        </div>
                        <button type="button" id="previewBtn" class="btn btn-preview">预览通知效果</button>
                        <button type="button" id="generateBtn" class="btn">生成正式通知</button>
                        <button type="button" class="btn btn-collect" id="collectBtn">收藏当前模板</button>
                        <button type="button" class="btn btn-clear" id="clearBtn">一键清空本地存储</button>
                        <div class="storage-tip">已自动保存表单数据，刷新页面不丢失</div>
                    </form>
                </div>
            </div>
            <!-- 结果面板 -->
            <div class="result-panel">
                <div class="panel">
                    <div class="result-header">
                        <h2>湖癔科技内部通知（可直接使用，支持编辑）</h2>
                        <div class="result-actions">
                            <button class="action-btn" id="copyBtn">复制全文</button>
                            <select class="export-select" id="exportType">
                                <option value="txt">导出为TXT</option>
                                <option value="word">导出为Word</option>
                                <option value="pdf">导出为PDF</option>
                            </select>
                            <button class="action-btn" id="downloadBtn">确认导出</button>
                            <button class="action-btn" id="editBtn">编辑内容</button>
                            <button class="action-btn" id="saveBtn" style="display:none;">保存修改</button>
                        </div>
                    </div>
                    <div class="notice-content" id="noticeContent" contenteditable="false">
                        请选择通知场景，点击"生成正式通知"或"预览通知效果"按钮获取完整内容...
                    </div>
                </div>
            </div>
        </div>
        <div class="footer">
            湖癔科技 © 2026 | 本通知模板基于公司内部管理制度制定，重大事项建议结合实际情况调整
        </div>
    </div>
    <script>
        // 1. 核心DOM元素直接获取（避免拼写错误）
        const noticeScene = document.getElementById('noticeScene');
        const generateBtn = document.getElementById('generateBtn');
        const previewBtn = document.getElementById('previewBtn');
        const collectBtn = document.getElementById('collectBtn');
        const noticeContent = document.getElementById('noticeContent');
        const copyBtn = document.getElementById('copyBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const exportType = document.getElementById('exportType');
        const clearBtn = document.getElementById('clearBtn');
        const editBtn = document.getElementById('editBtn');
        const saveBtn = document.getElementById('saveBtn');
        const noticeForm = document.getElementById('noticeForm');
        // 场景字段容器
        const employeeFields = document.getElementById('employeeFields');
        const systemFields = document.getElementById('systemFields');
        const securityFields = document.getElementById('securityFields');
        const generalFields = document.getElementById('generalFields');
        // 基础信息字段
        const noticeTitle = document.getElementById('noticeTitle');
        const noticeRecipient = document.getElementById('noticeRecipient');
        const noticeDate = document.getElementById('noticeDate');
        const noticeIssuer = document.getElementById('noticeIssuer');
        const contactPerson = document.getElementById('contactPerson');
        const additionalClause = document.getElementById('additionalClause');
        // 员工管理字段
        const employeeName = document.getElementById('employeeName');
        const employeeDept = document.getElementById('employeeDept');
        const employeeReason = document.getElementById('employeeReason');
        const employeeRule = document.getElementById('employeeRule');
        const employeeArrangement = document.getElementById('employeeArrangement');
        // 系统管理字段
        const systemName = document.getElementById('systemName');
        const systemVersion = document.getElementById('systemVersion');
        const systemTime = document.getElementById('systemTime');
        const systemContent = document.getElementById('systemContent');
        const systemRequirement = document.getElementById('systemRequirement');
        // 安全管理字段
        const securityEvent = document.getElementById('securityEvent');
        const securityTime = document.getElementById('securityTime');
        const securityImpact = document.getElementById('securityImpact');
        const securityMeasure = document.getElementById('securityMeasure');
        const securityResponsibility = document.getElementById('securityResponsibility');
        // 综合管理字段
        const generalTheme = document.getElementById('generalTheme');
        const generalDetail = document.getElementById('generalDetail');
        const generalRequirement = document.getElementById('generalRequirement');

        // 初始化日期为当天
        window.onload = function() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            noticeDate.value = `${year}年${month}月${day}日`;
            
            // 默认选中场景并触发显示
            noticeScene.value = 'employeeFired';
            noticeScene.onchange();
            
            // 加载本地存储的表单数据和收藏模板
            loadStoredData();
        };

        // 2. 法律依据自动生成函数
        function getLegalBasis(scene) {
            const legalMap = {
                'employeeFired': '《中华人民共和国劳动合同法》第三十九条、第四十条，' + employeeRule.value,
                'employeePromote': '《湖癔科技员工晋升管理办法》第二章第3条，《中华人民共和国劳动合同法》第十七条，' + employeeRule.value,
                'employeeTransfer': '《湖癔科技员工岗位调整管理规范》第四条，《中华人民共和国劳动合同法》第三十五条，' + employeeRule.value,
                'employeeTraining': '《湖癔科技员工培训管理办法》第三章第2条，' + employeeRule.value,
                'employeeDiscipline': '《中华人民共和国劳动合同法》第三十九条，' + employeeRule.value,
                'systemLaunch': '《中华人民共和国网络安全法》第二十一条，《湖癔科技系统上线管理规范》第五章，' + employeeRule.value,
                'systemUpdate': '《湖癔科技系统运维管理办法》第三章第6条，' + employeeRule.value,
                'systemMaintenance': '《中华人民共和国网络安全法》第二十一条，《湖癔科技系统运维管理规范》第四章，' + employeeRule.value,
                'systemTest': '《湖癔科技系统测试管理办法》第二条，' + employeeRule.value,
                'systemStop': '《湖癔科技系统停用管理规范》第三条，' + employeeRule.value,
                'networkAttack': '《中华人民共和国网络安全法》第二十五条、第五十九条，《中华人民共和国数据安全法》第二十九条，' + employeeRule.value,
                'virusAttack': '《中华人民共和国网络安全法》第二十五条，《中华人民共和国计算机信息系统安全保护条例》第十八条，' + employeeRule.value,
                'dataSecurity': '《中华人民共和国数据安全法》第二十一条、第二十九条，' + employeeRule.value,
                'securityTraining': '《中华人民共和国网络安全法》第二十一条，《湖癔科技网络安全培训管理办法》，' + employeeRule.value,
                'meetingNotice': '《湖癔科技会议管理办法》第三条，' + employeeRule.value,
                'officeMove': '《湖癔科技办公场所管理规范》第七条，' + employeeRule.value,
                'holidayArrangement': '《全国年节及纪念日放假办法》，《湖癔科技考勤管理办法》第五章，' + employeeRule.value,
                'otherNotice': employeeRule.value || '《湖癔科技内部管理制度》相关规定'
            };
            return legalMap[scene] || '《湖癔科技内部管理制度》相关规定';
        }

        // 3. 场景切换逻辑（直接显示/隐藏，无冗余）
        noticeScene.onchange = function() {
            // 隐藏所有场景
            employeeFields.style.display = 'none';
            systemFields.style.display = 'none';
            securityFields.style.display = 'none';
            generalFields.style.display = 'none';
            // 显示对应场景
            switch(this.value) {
                case 'employeeFired':
                case 'employeePromote':
                case 'employeeTransfer':
                case 'employeeTraining':
                case 'employeeDiscipline':
                    employeeFields.style.display = 'block';
                    break;
                case 'systemLaunch':
                case 'systemUpdate':
                case 'systemMaintenance':
                case 'systemTest':
                case 'systemStop':
                    systemFields.style.display = 'block';
                    break;
                case 'networkAttack':
                case 'virusAttack':
                case 'dataSecurity':
                case 'securityTraining':
                    securityFields.style.display = 'block';
                    break;
                case 'meetingNotice':
                case 'officeMove':
                case 'holidayArrangement':
                case 'otherNotice':
                    generalFields.style.display = 'block';
                    break;
            }
            // 自动生成标题
            generateDefaultTitle(this.value);
            // 保存当前表单数据
            saveFormData();
        };

        // 4. 生成默认标题（避免空值）
        function generateDefaultTitle(scene) {
            const empName = employeeName?.value || '相关员工';
            const sysName = systemName?.value || '自研系统';
            const theme = generalTheme?.value || '内部事项';
            const titleMap = {
                'employeeFired': `关于${empName}同志的开除通知`,
                'employeePromote': `关于${empName}同志的晋升通知`,
                'employeeTransfer': `关于${empName}同志的调岗通知`,
                'employeeTraining': `关于开展${theme}专项培训的通知`,
                'employeeDiscipline': `关于${empName}同志违纪行为的警告通知`,
                'systemLaunch': `关于${sysName}正式上线的通知`,
                'systemUpdate': `关于${sysName}版本更新的通知`,
                'systemMaintenance': `关于${sysName}系统维护的通知`,
                'systemTest': `关于${sysName}内部测试的通知`,
                'systemStop': `关于${sysName}停用的通知`,
                'networkAttack': `关于防范服务器网络攻击的紧急预警通知`,
                'virusAttack': `关于应对病毒攻击的应急通知`,
                'dataSecurity': `关于加强数据安全管控的通知`,
                'securityTraining': `关于开展网络安全专项培训的通知`,
                'meetingNotice': `关于召开${theme}的通知`,
                'officeMove': `关于公司办公地址搬迁的通知`,
                'holidayArrangement': `关于${theme}的通知`,
                'otherNotice': `关于${theme}的内部通知`
            };
            noticeTitle.value = titleMap[scene] || '湖癔科技内部通知';
        }

        // 5. 表单验证（逐字段检查，必出反馈）
        function validateForm(scene) {
            // 基础信息验证
            if (!noticeRecipient.value.trim()) {
                alert('❌ 请填写通知对象！');
                noticeRecipient.focus();
                return false;
            }
            if (!noticeDate.value.trim()) {
                alert('❌ 请填写发布日期！');
                noticeDate.focus();
                return false;
            }
            if (!noticeIssuer.value.trim()) {
                alert('❌ 请填写发布部门！');
                noticeIssuer.focus();
                return false;
            }
            if (!contactPerson.value.trim()) {
                alert('❌ 请填写联系人及联系方式！');
                contactPerson.focus();
                return false;
            }
            // 场景专属验证
            if (scene.includes('employee')) {
                if (!employeeName.value.trim()) {
                    alert('❌ 请填写员工姓名！');
                    employeeName.focus();
                    return false;
                }
                if (!employeeDept.value.trim()) {
                    alert('❌ 请填写所属部门！');
                    employeeDept.focus();
                    return false;
                }
                if (!employeeReason.value.trim()) {
                    alert('❌ 请填写事由详情！');
                    employeeReason.focus();
                    return false;
                }
            } else if (scene.includes('system')) {
                if (!systemName.value.trim()) {
                    alert('❌ 请填写系统名称！');
                    systemName.focus();
                    return false;
                }
                if (!systemTime.value.trim()) {
                    alert('❌ 请填写相关时间！');
                    systemTime.focus();
                    return false;
                }
                if (!systemContent.value.trim()) {
                    alert('❌ 请填写核心内容！');
                    systemContent.focus();
                    return false;
                }
            } else if (scene.includes('security')) {
                if (!securityEvent.value.trim()) {
                    alert('❌ 请填写安全事件详情！');
                    securityEvent.focus();
                    return false;
                }
                if (!securityTime.value.trim()) {
                    alert('❌ 请填写事件时间！');
                    securityTime.focus();
                    return false;
                }
                if (!securityMeasure.value.trim()) {
                    alert('❌ 请填写应急措施！');
                    securityMeasure.focus();
                    return false;
                }
            } else if (scene.includes('general') || scene.includes('meeting') || scene.includes('office') || scene.includes('holiday') || scene.includes('other')) {
                if (!generalTheme.value.trim()) {
                    alert('❌ 请填写通知核心主题！');
                    generalTheme.focus();
                    return false;
                }
                if (!generalDetail.value.trim()) {
                    alert('❌ 请填写具体详情！');
                    generalDetail.focus();
                    return false;
                }
            }
            return true;
        }

        // 6. 生成通知核心逻辑（无冗余，必出结果）
        function generateNotice(isPreview = false) {
            try {
                const scene = noticeScene.value;
                if (!scene) {
                    alert('❌ 请选择通知场景！');
                    return;
                }
                // 先验证表单
                if (!validateForm(scene)) return;
                // 收集数据（确保无空值）
                const data = {
                    title: noticeTitle.value,
                    recipient: noticeRecipient.value,
                    date: noticeDate.value,
                    issuer: noticeIssuer.value,
                    contact: contactPerson.value,
                    additional: additionalClause.value,
                    legalBasis: getLegalBasis(scene),
                    // 员工数据
                    emp: {
                        name: employeeName.value,
                        dept: employeeDept.value,
                        reason: employeeReason.value,
                        rule: employeeRule.value,
                        arrange: employeeArrangement.value
                    },
                    // 系统数据
                    sys: {
                        name: systemName.value,
                        ver: systemVersion.value,
                        time: systemTime.value,
                        content: systemContent.value,
                        req: systemRequirement.value
                    },
                    // 安全数据
                    sec: {
                        event: securityEvent.value,
                        time: securityTime.value,
                        impact: securityImpact.value,
                        measure: securityMeasure.value,
                        duty: securityResponsibility.value
                    },
                    // 综合数据
                    gen: {
                        theme: generalTheme.value,
                        detail: generalDetail.value,
                        req: generalRequirement.value
                    }
                };
                // 生成对应场景通知
                let noticeText = '';
                if (scene === 'employeeFired') {
                    noticeText = `
${data.title}
致：${data.recipient}
根据${data.legalBasis}及公司员工管理相关规定，现就${data.emp.name}同志的违纪处理事宜通知如下：
一、违纪事实说明
${data.emp.reason}
该行为已严重违反公司规章制度，对部门正常运营造成不良影响，经公司管理层研究决定，给予${data.emp.name}同志开除处理。
二、后续工作安排
${data.emp.arrange}
1. 请${data.emp.dept}负责人监督完成工作交接，交接清单需经双方签字确认后提交人力资源部；
2. 人力资源部需在3个工作日内办理离职手续、社保公积金停缴等事宜；
3. 该员工离职后不得以公司名义开展任何活动，若存在商业秘密泄露行为，公司将追究法律责任。
${data.additional}
特此通知。
${data.issuer}
${data.date}
联系人：${data.contact}
`;
                } else if (scene === 'employeePromote') {
                    noticeText = `
${data.title}
致：${data.recipient}
根据${data.legalBasis}及公司人才发展规划，经部门推荐、管理层审议通过，现就${data.emp.name}同志晋升事宜通知如下：
一、晋升基本信息
1. 原岗位：${data.emp.dept}${data.emp.name}同志原岗位
2. 新岗位：${data.emp.arrange.split('；')[0].replace('1. ', '')}
3. 生效时间：${data.emp.arrange.split('；')[1]?.replace('2. ', '') || '本通知发布之日起'}
二、晋升依据
${data.emp.reason}
三、工作要求
1. 请${data.emp.name}同志在3个工作日内完成原岗位工作交接，尽快熟悉新岗位职责；
2. 新岗位薪酬待遇将按公司薪酬体系执行，具体由人力资源部另行通知；
3. 望${data.emp.name}同志在新岗位上再接再厉，发挥更大价值，带动团队共同进步。
${data.additional}
特此通知。
${data.issuer}
${data.date}
联系人：${data.contact}
`;
                } else if (scene === 'systemLaunch') {
                    noticeText = `
${data.title}
致：${data.recipient}
为提升公司运营效率，优化业务流程，公司自主研发的${data.sys.name}（${data.sys.ver}）已完成测试验收，现正式上线运行，具体事宜通知如下：
一、上线核心信息
1. 上线时间：${data.sys.time}
2. 系统功能：${data.sys.content}
3. 访问路径：公司内部办公系统首页「新系统入口」
二、使用要求
${data.sys.req}
1. 各部门需在上线前组织员工学习操作手册（人力资源部将统一发放）；
2. 重要数据需提前备份，避免系统切换期间丢失；
3. 使用中遇到问题可联系技术部支持（电话：13900139000），工作日9:00-18:00实时响应。
三、法律依据
本系统上线及使用严格遵循${data.legalBasis}相关规定，确保数据安全与合规运营。
${data.additional}
特此通知。
${data.issuer}
${data.date}
联系人：${data.contact}
`;
                } else if (scene === 'networkAttack') {
                    noticeText = `
${data.title}
致：${data.recipient}
接公司安全监测中心预警，${data.sec.time}公司核心服务器遭遇DDoS攻击，为保障网络安全及业务连续性，现就应急防控事宜通知如下：
一、事件影响范围
${data.sec.impact}
二、应急防控措施
${data.sec.measure}
三、责任分工与上报
${data.sec.duty}
1. 技术部成立应急小组，24小时值守监测攻击动态；
2. 各部门需在1小时内完成本部门设备安全检查，排查异常链接；
3. 严禁员工擅自处理异常情况，所有问题统一上报安全应急小组。
四、法律依据
本次应急处置依据${data.legalBasis}执行，对违反防控要求造成损失的，将追究相关责任。
本通知自发布之日起生效，应急状态持续至风险解除。请全体员工高度重视，严格执行防控要求，共同保障公司网络安全。
${data.additional}
特此通知。
${data.issuer}
${data.date}
联系人：${data.contact}
`;
                } else if (scene === 'holidayArrangement') {
                    noticeText = `
${data.title}
致：${data.recipient}
为合理安排节假日期间工作与休息，保障公司业务平稳运行，现将${data.gen.theme}通知如下：
一、假期具体安排
${data.gen.detail}
二、相关工作要求
${data.gen.req}
1. 各部门需在放假前完成工作交接，明确值班人员及联系方式；
2. 财务部门需提前完成月度结账，确保资金安全；
3. 行政部门负责办公区域安全检查，关闭水电及门窗。
三、法律依据
本次放假安排符合${data.legalBasis}相关规定。
祝全体员工节日快乐，出行安全！
${data.additional}
特此通知。
${data.issuer}
${data.date}
联系人：${data.contact}
`;
                } else {
                    // 其他场景通用模板
                    noticeText = `
${data.title}
致：${data.recipient}
现就${scene.includes('employee') ? data.emp.name + '同志相关事宜' : scene.includes('system') ? data.sys.name + '相关事宜' : scene.includes('security') ? '网络安全防控事宜' : data.gen.theme}，通知如下：
一、核心事项说明
${scene.includes('employee') ? data.emp.reason : scene.includes('system') ? data.sys.content : scene.includes('security') ? data.sec.event : data.gen.detail}
二、相关要求与安排
${scene.includes('employee') ? data.emp.arrange : scene.includes('system') ? data.sys.req : scene.includes('security') ? data.sec.measure : data.gen.req}
三、法律依据
本通知依据${data.legalBasis}制定，请严格遵照执行。
${data.additional}
特此通知。
${data.issuer}
${data.date}
联系人：${data.contact}
`;
                }
                // 渲染结果，必显示
                noticeContent.textContent = noticeText;
                if (isPreview) {
                    alert(`✅ 预览效果生成成功！${isPreview ? '可提前查看修改，确认后点击"生成正式通知"' : '可直接复制或导出使用'}`);
                } else {
                    alert(`✅ 通知生成成功！可直接复制或导出使用，支持编辑修改`);
                }
                // 保存生成的内容
                saveFormData();
            } catch (err) {
                // 强制捕获错误，不白屏
                console.error('生成错误：', err);
                alert(`❌ 生成失败！请检查填写内容，错误信息：${err.message}`);
                noticeContent.textContent = '生成失败，请重试（可检查必填项是否完整填写）...';
            }
        }

        // 生成按钮事件
        generateBtn.onclick = function() {
            generateNotice(false);
        };

        // 预览按钮事件
        previewBtn.onclick = function() {
            generateNotice(true);
        };

        // 7. 编辑功能
        editBtn.onclick = function() {
            if (noticeContent.textContent.includes('请选择')) {
                alert('❌ 请先生成或预览通知再编辑！');
                return;
            }
            noticeContent.contentEditable = true;
            noticeContent.focus();
            editBtn.style.display = 'none';
            saveBtn.style.display = 'inline-block';
            alert('✅ 进入编辑模式，修改后点击"保存修改"即可生效');
        };

        // 保存修改功能
        saveBtn.onclick = function() {
            noticeContent.contentEditable = false;
            saveBtn.style.display = 'none';
            editBtn.style.display = 'inline-block';
            alert('✅ 修改已保存！可继续复制或导出');
            // 保存修改后的内容
            saveFormData();
        };

        // 8. 复制功能（简化，必反馈）
        copyBtn.onclick = function() {
            if (noticeContent.textContent.includes('请选择')) {
                alert('❌ 请先生成通知！');
                return;
            }
            navigator.clipboard.writeText(noticeContent.textContent).then(() => {
                alert('✅ 已复制到剪贴板！');
            }).catch(() => {
                alert('❌ 复制失败，请手动复制！');
            });
        };

        // 9. 导出功能（支持多格式）
        downloadBtn.onclick = function() {
            if (noticeContent.textContent.includes('请选择')) {
                alert('❌ 请先生成通知！');
                return;
            }
            const type = exportType.value;
            const content = noticeContent.textContent;
            const blob = new Blob([content], { type: type === 'txt' ? 'text/plain' : type === 'word' ? 'application/msword' : 'application/pdf' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `湖癔科技内部通知_${noticeTitle.value}_${new Date().toLocaleDateString()}.${type}`;
            a.click();
            alert(`✅ 导出成功！文件已保存至下载文件夹`);
        };

        // 10. 收藏模板功能
        collectBtn.onclick = function() {
            const scene = noticeScene.value;
            if (!scene) {
                alert('❌ 请选择通知场景后再收藏！');
                return;
            }
            const templateName = prompt('请输入模板名称（便于后续查找）：', noticeTitle.value);
            if (!templateName) return;
            const templateData = {
                name: templateName,
                scene: scene,
                data: {
                    noticeTitle: noticeTitle.value,
                    noticeRecipient: noticeRecipient.value,
                    noticeDate: noticeDate.value,
                    noticeIssuer: noticeIssuer.value,
                    contactPerson: contactPerson.value,
                    additionalClause: additionalClause.value,
                    // 员工数据
                    employeeName: employeeName?.value,
                    employeeDept: employeeDept?.value,
                    employeeReason: employeeReason?.value,
                    employeeRule: employeeRule?.value,
                    employeeArrangement: employeeArrangement?.value,
                    // 系统数据
                    systemName: systemName?.value,
                    systemVersion: systemVersion?.value,
                    systemTime: systemTime?.value,
                    systemContent: systemContent?.value,
                    systemRequirement: systemRequirement?.value,
                    // 安全数据
                    securityEvent: securityEvent?.value,
                    securityTime: securityTime?.value,
                    securityImpact: securityImpact?.value,
                    securityMeasure: securityMeasure?.value,
                    securityResponsibility: securityResponsibility?.value,
                    // 综合数据
                    generalTheme: generalTheme?.value,
                    generalDetail: generalDetail?.value,
                    generalRequirement: generalRequirement?.value
                }
            };
            // 获取已收藏模板
            const collectedTemplates = JSON.parse(localStorage.getItem('huyiCollectedTemplates') || '[]');
            collectedTemplates.push(templateData);
            localStorage.setItem('huyiCollectedTemplates', JSON.stringify(collectedTemplates));
            alert(`✅ 模板收藏成功！名称：${templateName}`);
        };

        // 11. 一键清空本地存储功能
        clearBtn.onclick = function() {
            try {
                if (confirm('确定要清空本地存储的表单数据和收藏模板吗？清空后不可恢复！')) {
                    // 清空本地存储
                    localStorage.removeItem('huyiNoticeFormData');
                    localStorage.removeItem('huyiCollectedTemplates');
                    // 重置表单
                    noticeForm.reset();
                    // 恢复默认值
                    noticeRecipient.value = '全体员工';
                    const today = new Date();
                    const year = today.getFullYear();
                    const month = String(today.getMonth() + 1).padStart(2, '0');
                    const day = String(today.getDate()).padStart(2, '0');
                    noticeDate.value = `${year}年${month}月${day}日`;
                    noticeIssuer.value = '湖癔科技人力资源部';
                    contactPerson.value = '张经理，电话：13800138000';
                    additionalClause.value = `1. 本通知自发布之日起生效，未尽事宜可联系相关负责人咨询；
2. 请相关方严格遵照执行，逾期未落实将按公司制度处理；
3. 本通知最终解释权归湖癔科技相关部门所有。`;
                    // 重置结果区文本
                    noticeContent.textContent = '请选择通知场景，点击"生成正式通知"或"预览通知效果"按钮获取完整内容...';
                    // 弹出成功提示
                    alert('✅ 本地存储已成功清空！');
                }
            } catch (err) {
                // 捕获错误，避免无反应
                console.error('清空本地存储失败：', err);
                alert(`❌ 清空失败！错误信息：${err.message}`);
            }
        };

        // 12. 保存表单数据到本地存储
        function saveFormData() {
            const formData = {
                scene: noticeScene.value,
                noticeTitle: noticeTitle.value,
                noticeRecipient: noticeRecipient.value,
                noticeDate: noticeDate.value,
                noticeIssuer: noticeIssuer.value,
                contactPerson: contactPerson.value,
                additionalClause: additionalClause.value,
                // 员工数据
                employeeName: employeeName?.value,
                employeeDept: employeeDept?.value,
                employeeReason: employeeReason?.value,
                employeeRule: employeeRule?.value,
                employeeArrangement: employeeArrangement?.value,
                // 系统数据
                systemName: systemName?.value,
                systemVersion: systemVersion?.value,
                systemTime: systemTime?.value,
                systemContent: systemContent?.value,
                systemRequirement: systemRequirement?.value,
                // 安全数据
                securityEvent: securityEvent?.value,
                securityTime: securityTime?.value,
                securityImpact: securityImpact?.value,
                securityMeasure: securityMeasure?.value,
                securityResponsibility: securityResponsibility?.value,
                // 综合数据
                generalTheme: generalTheme?.value,
                generalDetail: generalDetail?.value,
                generalRequirement: generalRequirement?.value,
                // 生成的内容
                noticeContent: noticeContent.textContent
            };
            localStorage.setItem('huyiNoticeFormData', JSON.stringify(formData));
        }

        // 13. 加载本地存储的表单数据
        function loadStoredData() {
            const storedData = localStorage.getItem('huyiNoticeFormData');
            if (storedData) {
                const formData = JSON.parse(storedData);
                // 恢复场景
                noticeScene.value = formData.scene;
                // 恢复基础信息
                noticeTitle.value = formData.noticeTitle || '';
                noticeRecipient.value = formData.noticeRecipient || '全体员工';
                noticeDate.value = formData.noticeDate || '';
                noticeIssuer.value = formData.noticeIssuer || '湖癔科技人力资源部';
                contactPerson.value = formData.contactPerson || '张经理，电话：13800138000';
                additionalClause.value = formData.additionalClause || '';
                // 恢复员工数据
                if (employeeName) employeeName.value = formData.employeeName || '张三';
                if (employeeDept) employeeDept.value = formData.employeeDept || '市场部';
                if (employeeReason) employeeReason.value = formData.employeeReason || '';
                if (employeeRule) employeeRule.value = formData.employeeRule || '';
                if (employeeArrangement) employeeArrangement.value = formData.employeeArrangement || '';
                // 恢复系统数据
                if (systemName) systemName.value = formData.systemName || '湖癔科技OS V2.0';
                if (systemVersion) systemVersion.value = formData.systemVersion || 'V2.0正式版';
                if (systemTime) systemTime.value = formData.systemTime || '';
                if (systemContent) systemContent.value = formData.systemContent || '';
                if (systemRequirement) systemRequirement.value = formData.systemRequirement || '';
                // 恢复安全数据
                if (securityEvent) securityEvent.value = formData.securityEvent || '';
                if (securityTime) securityTime.value = formData.securityTime || '';
                if (securityImpact) securityImpact.value = formData.securityImpact || '';
                if (securityMeasure) securityMeasure.value = formData.securityMeasure || '';
                if (securityResponsibility) securityResponsibility.value = formData.securityResponsibility || '';
                // 恢复综合数据
                if (generalTheme) generalTheme.value = formData.generalTheme || '';
                if (generalDetail) generalDetail.value = formData.generalDetail || '';
                if (generalRequirement) generalRequirement.value = formData.generalRequirement || '';
                // 恢复生成的内容
                if (formData.noticeContent) {
                    noticeContent.textContent = formData.noticeContent;
                }
                // 触发场景显示
                noticeScene.onchange();
            }
        }

        // 监听表单字段变化，实时保存数据
        const formFields = [
            noticeScene, noticeTitle, noticeRecipient, noticeDate, noticeIssuer, contactPerson, additionalClause,
            employeeName, employeeDept, employeeReason, employeeRule, employeeArrangement,
            systemName, systemVersion, systemTime, systemContent, systemRequirement,
            securityEvent, securityTime, securityImpact, securityMeasure, securityResponsibility,
            generalTheme, generalDetail, generalRequirement
        ];
        formFields.forEach(field => {
            if (field) {
                field.addEventListener('input', saveFormData);
            }
        });
    </script>
</body>
</html>
