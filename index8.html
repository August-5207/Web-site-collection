<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>湖癔科技 - 全能计算工具</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }
        body {
            background: #f0f2f5;
            padding: 10px;
            min-height: 100vh;
            color: #222;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            padding: 20px 15px;
            border-radius: 12px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1a1a1a;
            text-align: center;
            margin-bottom: 20px;
            font-size: 22px;
            line-height: 1.4;
            font-weight: 600;
        }
        .calc-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
            overflow-x: auto;
            padding-bottom: 5px;
        }
        .tab-btn {
            padding: 6px 12px;
            background: #e9ecef;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            white-space: nowrap;
            font-size: 13px;
            color: #333;
            flex-shrink: 0;
        }
        .tab-btn.active {
            background: #2c3e50;
            color: #fff;
        }
        .calc-content {
            display: none;
            margin-top: 10px;
        }
        .calc-content.show {
            display: block;
        }
        h2 {
            color: #222;
            font-size: 16px;
            margin: 0 0 15px;
            padding-bottom: 6px;
            border-bottom: 2px solid #ddd;
            font-weight: 600;
        }
        .input-group {
            margin: 10px 0;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        label {
            color: #333;
            font-weight: 500;
            font-size: 13px;
        }
        input, select, textarea {
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            width: 100%;
            color: #222;
            background: #fafafa;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        button {
            padding: 8px 10px;
            background: #2c3e50;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 8px;
            width: 100%;
        }
        button:hover {
            background: #34495e;
        }
        /* 结果区域 + 复制按钮 */
        .result-wrap {
            position: relative;
            margin-top: 12px;
        }
        .result {
            padding: 12px;
            background: #f5f5f5;
            border-radius: 6px;
            border-left: 4px solid #2c3e50;
        }
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 4px 8px;
            font-size: 12px;
            background: #3498db;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: auto;
            margin-top: 0;
        }
        .copy-btn:hover {
            background: #2980b9;
        }
        .result p {
            color: #222;
            font-size: 13px;
            line-height: 1.6;
            margin: 3px 0;
        }
        .result span {
            font-weight: bold;
            color: #e74c3c;
        }
        /* 复制提示 */
        .copy-tip {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 10px 20px;
            background: rgba(0,0,0,0.7);
            color: #fff;
            border-radius: 6px;
            font-size: 14px;
            display: none;
            z-index: 9999;
        }
        .grid-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .func-btns {
            display: flex;
            gap: 8px;
            margin: 15px 0;
        }
        .func-btn {
            flex: 1;
            background: #e74c3c;
        }
        .func-btn:hover {
            background: #c0392b;
        }
        .footer {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 12px;
        }
        .back-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #2c3e50;
            color: #fff;
            border: none;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            z-index: 999;
        }
        .back-to-top.show {
            display: flex;
        }
        @media (max-width: 768px) {
            .grid-layout {
                grid-template-columns: 1fr;
            }
            .container {
                padding: 15px 10px;
            }
            h1 {
                font-size: 20px;
            }
            .tab-btn {
                font-size: 12px;
                padding: 5px 10px;
            }
        }
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            .calc-tabs {
                gap: 4px;
            }
            input, select, textarea {
                font-size: 13px;
                padding: 7px 8px;
            }
            .back-to-top {
                width: 35px;
                height: 35px;
                bottom: 15px;
                right: 15px;
            }
            .copy-btn {
                font-size: 10px;
                padding: 2px 6px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>湖癔科技 - 全能计算工具</h1>
        
        <div class="calc-tabs">
            <button class="tab-btn active" onclick="showTab('music-calc')">QQ音乐进度</button>
            <button class="tab-btn" onclick="showTab('date-past')">过往天数</button>
            <button class="tab-btn" onclick="showTab('date-future')">未来日期</button>
            <button class="tab-btn" onclick="showTab('countdown')">倒计时</button>
            <button class="tab-btn" onclick="showTab('anniversary')">纪念日</button>
            <button class="tab-btn" onclick="showTab('age')">年龄计算</button>
            <button class="tab-btn" onclick="showTab('time-convert')">时间换算</button>
            <button class="tab-btn" onclick="showTab('unit-convert')">单位换算</button>
            <button class="tab-btn" onclick="showTab('number-calc')">数值计算</button>
            <button class="tab-btn" onclick="showTab('life-calc')">生活计算</button>
        </div>

        <div class="func-btns">
            <button class="func-btn" onclick="clearAllData()">一键清空本地存储</button>
        </div>

        <div class="grid-layout">
            <div class="left-col">
                <div class="calc-content show" id="music-calc">
                    <h2>QQ音乐听歌进度计算</h2>
                    <div class="input-group">
                        <label>歌单时长（每行一首 分:秒）</label>
                        <textarea id="songList" placeholder="请输入歌曲时长，每行一条，格式如 4:52"></textarea>
                    </div>
                    <button onclick="calcSong()">计算歌单数据</button>
                    <div class="result-wrap">
                        <div class="result" id="songRes">点击计算</div>
                        <button class="copy-btn" onclick="copyResult('songRes')">复制</button>
                    </div>

                    <div class="input-group" style="margin-top:15px">
                        <label>当前已听遍数</label><input type="number" id="cPlays" placeholder="输入已听遍数">
                        <label>当前已听分钟</label><input type="number" id="cMins" placeholder="输入已听分钟数">
                        <label>目标遍数</label><input type="number" id="tPlays" placeholder="输入目标总遍数">
                        <label>目标分钟</label><input type="number" id="tMins" placeholder="输入目标总分钟数">
                    </div>
                    <button onclick="calcMusic()">计算听歌进度</button>
                    <div class="result-wrap">
                        <div class="result" id="musicRes">点击计算</div>
                        <button class="copy-btn" onclick="copyResult('musicRes')">复制</button>
                    </div>
                </div>

                <div class="calc-content" id="date-past">
                    <h2>过往天数计算</h2>
                    <div class="input-group">
                        <label>过去日期</label><input type="date" id="pDate" value="2025-08-01">
                        <label>截止日期（默认今天）</label><input type="date" id="eDate">
                    </div>
                    <button onclick="calcPast()">计算</button>
                    <div class="result-wrap">
                        <div class="result" id="pastRes">点击计算</div>
                        <button class="copy-btn" onclick="copyResult('pastRes')">复制</button>
                    </div>
                </div>

                <div class="calc-content" id="date-future">
                    <h2>未来日期推算</h2>
                    <div class="input-group">
                        <label>起始日期</label><input type="date" id="sDate" value="2026-01-11">
                        <label>结束日期（留空则加天数）</label><input type="date" id="endDate">
                        <label>增加天数</label><input type="number" id="addDay" value="30">
                    </div>
                    <button onclick="calcFuture()">计算</button>
                    <div class="result-wrap">
                        <div class="result" id="futureRes">点击计算</div>
                        <button class="copy-btn" onclick="copyResult('futureRes')">复制</button>
                    </div>
                </div>

                <div class="calc-content" id="countdown">
                    <h2>目标倒计时</h2>
                    <div class="input-group">
                        <label>目标日期</label><input type="date" id="tarDate" value="2026-02-17">
                        <label>目标时间</label><input type="time" id="tarTime" value="00:00">
                    </div>
                    <button onclick="calcCount()">计算</button>
                    <div class="result-wrap">
                        <div class="result" id="countRes">点击计算</div>
                        <button class="copy-btn" onclick="copyResult('countRes')">复制</button>
                    </div>
                </div>
            </div>

            <div class="right-col">
                <div class="calc-content" id="anniversary">
                    <h2>纪念日周期</h2>
                    <div class="input-group">
                        <label>纪念日日期</label><input type="date" id="anniDate" value="2025-08-15">
                    </div>
                    <button onclick="calcAnni()">计算</button>
                    <div class="result-wrap">
                        <div class="result" id="anniRes">点击计算</div>
                        <button class="copy-btn" onclick="copyResult('anniRes')">复制</button>
                    </div>
                </div>

                <div class="calc-content" id="age">
                    <h2>年龄计算</h2>
                    <div class="input-group">
                        <label>出生日期</label><input type="date" id="bDate" value="2000-01-01">
                        <label>计算日期（默认今天）</label><input type="date" id="calcD">
                    </div>
                    <button onclick="calcAge()">计算</button>
                    <div class="result-wrap">
                        <div class="result" id="ageRes">点击计算</div>
                        <button class="copy-btn" onclick="copyResult('ageRes')">复制</button>
                    </div>
                </div>

                <div class="calc-content" id="time-convert">
                    <h2>时间单位换算</h2>
                    <div class="input-group">
                        <label>数值</label><input type="number" id="timeVal" value="1000">
                        <label>原单位</label>
                        <select id="timeUnit">
                            <option value="s">秒</option><option value="min" selected>分钟</option>
                            <option value="h">小时</option><option value="d">天</option>
                            <option value="w">周</option><option value="m">月</option><option value="y">年</option>
                        </select>
                    </div>
                    <button onclick="convTime()">换算</button>
                    <div class="result-wrap">
                        <div class="result" id="timeRes">点击计算</div>
                        <button class="copy-btn" onclick="copyResult('timeRes')">复制</button>
                    </div>
                </div>

                <div class="calc-content" id="unit-convert">
                    <h2>常用单位换算</h2>
                    <div class="input-group">
                        <label>数值</label><input type="number" id="unitVal" value="1">
                        <label>类型</label>
                        <select id="unitType" onchange="changeUnit()">
                            <option value="length">长度</option><option value="weight">重量</option><option value="storage">存储</option>
                        </select>
                        <label>原单位</label><select id="unitFrom"></select>
                    </div>
                    <button onclick="convUnit()">换算</button>
                    <div class="result-wrap">
                        <div class="result" id="unitRes">点击计算</div>
                        <button class="copy-btn" onclick="copyResult('unitRes')">复制</button>
                    </div>
                </div>

                <div class="calc-content" id="number-calc">
                    <h2>数值计算</h2>
                    <div class="input-group">
                        <label>数值1</label><input type="number" id="n1" value="5200">
                        <label>运算</label>
                        <select id="opt">
                            <option value="-">-</option><option value="+">+</option><option value="*">×</option>
                            <option value="/">÷</option><option value="%">%</option><option value="^">^</option>
                        </select>
                        <label>数值2</label><input type="number" id="n2" value="1164">
                    </div>
                    <button onclick="calcNum()">计算</button>
                    <div class="result-wrap">
                        <div class="result" id="numRes">点击计算</div>
                        <button class="copy-btn" onclick="copyResult('numRes')">复制</button>
                    </div>
                </div>

                <div class="calc-content" id="life-calc">
                    <h2>生活计算</h2>
                    <div class="input-group">
                        <label>类型</label>
                        <select id="lifeType" onchange="changeLife()">
                            <option value="bmi">BMI指数</option><option value="discount">折扣</option><option value="loan">房贷</option>
                        </select>
                    </div>
                    <div id="bmi-box">
                        <label>身高(米)</label><input type="number" id="h" value="1.75" step="0.01">
                        <label>体重(kg)</label><input type="number" id="w" value="65">
                    </div>
                    <div id="discount-box" style="display:none">
                        <label>原价</label><input type="number" id="oriPrice" value="100">
                        <label>折扣(0.8=8折)</label><input type="number" id="disRate" value="0.8" step="0.1">
                    </div>
                    <div id="loan-box" style="display:none">
                        <label>贷款(万)</label><input type="number" id="loanAmt" value="100">
                        <label>年利率(%)</label><input type="number" id="loanRate" value="3.8" step="0.01">
                        <label>年限</label><input type="number" id="loanYear" value="30">
                    </div>
                    <button onclick="calcLife()">计算</button>
                    <div class="result-wrap">
                        <div class="result" id="lifeRes">点击计算</div>
                        <button class="copy-btn" onclick="copyResult('lifeRes')">复制</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">湖癔科技 &copy; 全能计算工具 | 数据本地存储 刷新不丢失</div>
    </div>

    <button class="back-to-top" onclick="backToTop()">↑</button>
    <div class="copy-tip" id="copyTip">复制成功！</div>

    <script>
        let avgMin = 0;
        const STORAGE_PREFIX = 'huyi_calc_';
        const backToTopBtn = document.querySelector('.back-to-top');
        const copyTip = document.getElementById('copyTip');

        // ========== 新增：复制结果功能 ==========
        function copyResult(resId) {
            const resultEl = document.getElementById(resId);
            const text = resultEl.innerText.trim();
            if(text === '点击计算' || text === '无效数据') {
                copyTip.innerText = '无数据可复制';
                copyTip.style.display = 'block';
                setTimeout(() => copyTip.style.display = 'none', 1500);
                return;
            }
            navigator.clipboard.writeText(text).then(() => {
                copyTip.innerText = '复制成功！';
                copyTip.style.display = 'block';
                setTimeout(() => copyTip.style.display = 'none', 1500);
            }).catch(() => {
                copyTip.innerText = '复制失败';
                copyTip.style.display = 'block';
                setTimeout(() => copyTip.style.display = 'none', 1500);
            });
        }

        // ========== 本地存储 ==========
        function saveData() {
            const data = {
                songList: document.getElementById('songList').value,
                cPlays: document.getElementById('cPlays').value,
                cMins: document.getElementById('cMins').value,
                tPlays: document.getElementById('tPlays').value,
                tMins: document.getElementById('tMins').value,
                pDate: document.getElementById('pDate').value,
                eDate: document.getElementById('eDate').value,
                sDate: document.getElementById('sDate').value,
                endDate: document.getElementById('endDate').value,
                addDay: document.getElementById('addDay').value,
                tarDate: document.getElementById('tarDate').value,
                tarTime: document.getElementById('tarTime').value,
                anniDate: document.getElementById('anniDate').value,
                bDate: document.getElementById('bDate').value,
                calcD: document.getElementById('calcD').value,
                timeVal: document.getElementById('timeVal').value,
                timeUnit: document.getElementById('timeUnit').value,
                unitVal: document.getElementById('unitVal').value,
                unitType: document.getElementById('unitType').value,
                unitFrom: document.getElementById('unitFrom').value,
                n1: document.getElementById('n1').value,
                n2: document.getElementById('n2').value,
                opt: document.getElementById('opt').value,
                lifeType: document.getElementById('lifeType').value,
                h: document.getElementById('h').value,
                w: document.getElementById('w').value,
                oriPrice: document.getElementById('oriPrice').value,
                disRate: document.getElementById('disRate').value,
                loanAmt: document.getElementById('loanAmt').value,
                loanRate: document.getElementById('loanRate').value,
                loanYear: document.getElementById('loanYear').value
            };
            localStorage.setItem(STORAGE_PREFIX + 'data', JSON.stringify(data));
        }

        function loadData() {
            const savedData = localStorage.getItem(STORAGE_PREFIX + 'data');
            if (!savedData) return;
            const data = JSON.parse(savedData);
            Object.keys(data).forEach(key => {
                const el = document.getElementById(key);
                if (el) el.value = data[key];
            });
            changeUnit();
            changeLife();
        }

        function clearAllData() {
            if (!confirm('确定要清空所有本地存储数据和输入内容吗？此操作不可恢复')) return;
            localStorage.removeItem(STORAGE_PREFIX + 'data');
            document.querySelectorAll('input, select, textarea').forEach(el => {
                el.value = el.tagName === 'TEXTAREA' ? '' : el.hasAttribute('placeholder') ? '' : el.defaultValue;
            });
            document.querySelectorAll('.result').forEach(el => {
                el.innerHTML = '<p>点击计算</p>';
            });
            avgMin = 0;
        }

        function backToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                backToTopBtn.classList.add('show');
            } else {
                backToTopBtn.classList.remove('show');
            }
        });

        // ========== 基础功能 ==========
        function showTab(id) {
            document.querySelectorAll('.calc-content').forEach(el => el.classList.remove('show'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('show');
            event.target.classList.add('active');
        }

        function changeUnit() {
            const type = document.getElementById('unitType').value;
            const from = document.getElementById('unitFrom');
            from.innerHTML = '';
            const units = {
                length: [{v:'m',t:'米'},{v:'km',t:'千米'},{v:'ft',t:'英尺'}],
                weight: [{v:'g',t:'克'},{v:'kg',t:'千克'},{v:'jin',t:'斤'}],
                storage: [{v:'B',t:'字节'},{v:'KB',t:'KB'},{v:'MB',t:'MB'}]
            };
            units[type].forEach(u => {
                const opt = document.createElement('option');
                opt.value = u.v; opt.textContent = u.t;
                from.appendChild(opt);
            });
            saveData();
        }

        function changeLife() {
            const type = document.getElementById('lifeType').value;
            document.getElementById('bmi-box').style.display = 'none';
            document.getElementById('discount-box').style.display = 'none';
            document.getElementById('loan-box').style.display = 'none';
            document.getElementById(type+'-box').style.display = 'block';
            saveData();
        }

        // ========== QQ音乐计算 ==========
        function calcSong() {
            const list = document.getElementById('songList').value.trim().split('\n');
            let s = 0, cnt = 0;
            list.forEach(line => {
                const [m, sec] = line.split(':').map(Number);
                if(!isNaN(m) && !isNaN(sec)) {s += m*60 + sec; cnt++;}
            });
            if(cnt === 0) {
                document.getElementById('songRes').innerHTML = '<p>无效数据</p>';
                return;
            }
            const totalMin = (s/60).toFixed(2);
            avgMin = (s/60/cnt).toFixed(2);
            document.getElementById('songRes').innerHTML = `
                <p>有效歌曲：<span>${cnt}</span> 首</p>
                <p>总时长：<span>${totalMin}</span> 分钟</p>
                <p>平均时长：<span>${avgMin}</span> 分钟/首</p>
            `;
            saveData();
        }

        function calcMusic() {
            const cP = +document.getElementById('cPlays').value;
            const cM = +document.getElementById('cMins').value;
            const tP = +document.getElementById('tPlays').value;
            const tM = +document.getElementById('tMins').value;
            if(isNaN(cP) || isNaN(cM) || isNaN(tP) || isNaN(tM)) {
                document.getElementById('musicRes').innerHTML = '<p>请填写所有数值</p>'; 
                return;
            }
            
            const rP = Math.max(0, tP - cP);
            const rM = Math.max(0, tM - cM);
            const eff = (cP / cM).toFixed(3);
            const timeByEff = (rP / (cP/cM)).toFixed(2);
            const timeByAvg = (rP * avgMin).toFixed(2);

            document.getElementById('musicRes').innerHTML = `
                <p>剩余遍数：<span>${rP}</span> | 剩余分钟：<span>${rM}</span></p>
                <p>听歌效率：<span>${eff}</span> 遍/分钟</p>
                <p>按效率需：<span>${timeByEff}</span> 分钟</p>
                <p>按平均时长需：<span>${timeByAvg}</span> 分钟</p>
            `;
            saveData();
        }

        // ========== 日期计算 ==========
        function calcPast() {
            const p = new Date(document.getElementById('pDate').value);
            const e = document.getElementById('eDate').value ? new Date(document.getElementById('eDate').value) : new Date();
            if(!p.getTime()) {document.getElementById('pastRes').innerHTML = '<p>无效日期</p>'; return;}
            if(p > e) {document.getElementById('pastRes').innerHTML = '<p>过去日期不能晚于截止日期</p>'; return;}
            
            const diff = e - p;
            const day = Math.floor(diff / (1000*60*60*24));
            const hour = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
            document.getElementById('pastRes').innerHTML = `
                <p>从 ${p.toLocaleDateString()} 到 ${e.toLocaleDateString()}</p>
                <p>已过去：<span>${day}</span> 天 ${hour} 小时</p>
            `;
            saveData();
        }

        function calcFuture() {
            const s = new Date(document.getElementById('sDate').value);
            const end = document.getElementById('endDate').value;
            const add = +document.getElementById('addDay').value;
            if(!s.getTime()) {document.getElementById('futureRes').innerHTML = '<p>无效日期</p>'; return;}
            
            let html = '';
            if(end) {
                const e = new Date(end);
                const day = Math.ceil(Math.abs(e - s) / (1000*60*60*24));
                html = `<p>日期差：<span>${day}</span> 天</p>`;
            } else {
                const f = new Date(s); f.setDate(f.getDate() + add);
                html = `<p>增加 ${add} 天后：<span>${f.toLocaleDateString()}</span></p>`;
            }
            document.getElementById('futureRes').innerHTML = html;
            saveData();
        }

        function calcCount() {
            const d = new Date(document.getElementById('tarDate').value);
            const t = document.getElementById('tarTime').value.split(':');
            d.setHours(t[0], t[1], 0);
            const now = new Date();
            if(!d.getTime()) {document.getElementById('countRes').innerHTML = '<p>无效日期</p>'; return;}
            
            const diff = d - now;
            if(diff < 0) {document.getElementById('countRes').innerHTML = '<p>目标日期已过</p>'; return;}
            
            const day = Math.floor(diff/(1000*60*60*24));
            const h = Math.floor((diff%(1000*60*60*24))/(1000*60*60));
            const m = Math.floor((diff%(1000*60*60))/(1000*60));
            const s = Math.floor((diff%(1000*60))/1000);
            document.getElementById('countRes').innerHTML = `<p>剩余：<span>${day}</span> 天 ${h} 时 ${m} 分 ${s} 秒</p>`;
            saveData();
        }

        function calcAnni() {
            const a = new Date(document.getElementById('anniDate').value);
            const now = new Date();
            if(!a.getTime()) {document.getElementById('anniRes').innerHTML = '<p>无效日期</p>'; return;}
            
            let next = new Date(now.getFullYear(), a.getMonth(), a.getDate());
            if(next < now) next.setFullYear(next.getFullYear() + 1);
            const day = Math.floor((next - now)/(1000*60*60*24));
            const year = next.getFullYear() - a.getFullYear();
            document.getElementById('anniRes').innerHTML = `
                <p>下次纪念日：<span>${next.toLocaleDateString()}</span></p>
                <p>剩余：<span>${day}</span> 天 | 第 ${year} 周年</p>
            `;
            saveData();
        }

        function calcAge() {
            const b = new Date(document.getElementById('bDate').value);
            const c = document.getElementById('calcD').value ? new Date(document.getElementById('calcD').value) : new Date();
            if(!b.getTime()) {document.getElementById('ageRes').innerHTML = '<p>无效日期</p>'; return;}
            
            let y = c.getFullYear() - b.getFullYear();
            let m = c.getMonth() - b.getMonth();
            let d = c.getDate() - b.getDate();
            if(d < 0) {m--; d += new Date(c.getFullYear(), c.getMonth(), 0).getDate();}
            if(m < 0) {y--; m += 12;}
            document.getElementById('ageRes').innerHTML = `<p>年龄：<span>${y}</span> 岁 ${m} 个月 ${d} 天</p>`;
            saveData();
        }

        // ========== 换算计算 ==========
        function convTime() {
            const val = +document.getElementById('timeVal').value;
            const unit = document.getElementById('timeUnit').value;
            if(isNaN(val)) {document.getElementById('timeRes').innerHTML = '<p>无效数值</p>'; return;}
            
            const secMap = {s:1, min:60, h:3600, d:86400, w:604800, m:2592000, y:31536000};
            const sec = val * secMap[unit];
            const y = Math.floor(sec/31536000);
            const m = Math.floor((sec%31536000)/2592000);
            const d = Math.floor((sec%2592000)/86400);
            const h = Math.floor((sec%86400)/3600);
            const min = Math.floor((sec%3600)/60);
            const s = Math.floor(sec%60);
            document.getElementById('timeRes').innerHTML = `<p>${val} ${unit} = <span>${y}年${m}月${d}天${h}时${min}分${s}秒</span></p>`;
            saveData();
        }

        function convUnit() {
            const val = +document.getElementById('unitVal').value;
            const type = document.getElementById('unitType').value;
            const from = document.getElementById('unitFrom').value;
            if(isNaN(val)) {document.getElementById('unitRes').innerHTML = '<p>无效数值</p>'; return;}
            
            let res = '';
            if(type === 'length') {
                const m = val * (from==='m'?1:from==='km'?1000:0.3048);
                res = `${val}${from} = <span>${m.toFixed(4)}米 ${(m/1000).toFixed(4)}千米</span>`;
            } else if(type === 'weight') {
                const g = val * (from==='g'?1:from==='kg'?1000:500);
                res = `${val}${from} = <span>${g.toFixed(4)}克 ${(g/1000).toFixed(4)}千克</span>`;
            } else if(type === 'storage') {
                const b = val * (from==='B'?1:from==='KB'?1024:1048576);
                res = `${val}${from} = <span>${b}B ${(b/1024).toFixed(2)}KB ${(b/1048576).toFixed(2)}MB</span>`;
            }
            document.getElementById('unitRes').innerHTML = `<p>${res}</p>`;
            saveData();
        }

        // ========== 数值&生活计算 ==========
        function calcNum() {
            const n1 = +document.getElementById('n1').value;
            const n2 = +document.getElementById('n2').value;
            const opt = document.getElementById('opt').value;
            if(isNaN(n1) || isNaN(n2)) {document.getElementById('numRes').innerHTML = '<p>无效数值</p>'; return;}
            
            let res = 0;
            switch(opt) {
                case '-': res = n1 - n2; break;
                case '+': res = n1 + n2; break;
                case '*': res = n1 * n2; break;
                case '/': res = n2===0?'除数不能为0':(n1/n2).toFixed(4); break;
                case '%': res = n1 % n2; break;
                case '^': res = Math.pow(n1, n2); break;
            }
            document.getElementById('numRes').innerHTML = `<p>${n1} ${opt} ${n2} = <span>${res}</span></p>`;
            saveData();
        }

        function calcLife() {
            const type = document.getElementById('lifeType').value;
            let res = '';
            if(type === 'bmi') {
                const h = +document.getElementById('h').value;
                const w = +document.getElementById('w').value;
                if(h<=0) {res = '身高无效';}
                else {
                    const bmi = (w/(h*h)).toFixed(2);
                    const status = bmi<18.5?'偏瘦':bmi<24?'正常':bmi<28?'超重':'肥胖';
                    res = `BMI：<span>${bmi}</span> | 状态：<span>${status}</span>`;
                }
            } else if(type === 'discount') {
                const ori = +document.getElementById('oriPrice').value;
                const rate = +document.getElementById('disRate').value;
                const final = (ori*rate).toFixed(2);
                res = `折后价：<span>${final}</span> 元 | 节省：<span>${(ori-final).toFixed(2)}</span> 元`;
            } else if(type === 'loan') {
                const amt = +document.getElementById('loanAmt').value * 10000;
                const rate = +document.getElementById('loanRate').value / 100 / 12;
                const year = +document.getElementById('loanYear').value * 12;
                const monthPay = (amt * rate * Math.pow(1+rate, year)) / (Math.pow(1+rate, year) - 1);
                res = `月供：<span>${monthPay.toFixed(2)}</span> 元 | 总还款：<span>${(monthPay*year).toFixed(2)}</span> 元`;
            }
            document.getElementById('lifeRes').innerHTML = `<p>${res}</p>`;
            saveData();
        }

        window.onload = function() {
            loadData();
            document.querySelectorAll('input, select, textarea').forEach(el => {
                el.addEventListener('input', saveData);
            });
        }
    </script>
</body>
</html>
